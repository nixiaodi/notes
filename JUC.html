
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>JUC · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="JVM.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2" data-path="JUC.html">
            
                <a href="JUC.html">
            
                    
                    JUC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="JVM.html">
            
                <a href="JVM.html">
            
                    
                    JVM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="Netty.html">
            
                <a href="Netty.html">
            
                    
                    Netty
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="RabbitMQ.html">
            
                <a href="RabbitMQ.html">
            
                    
                    Rabbit MQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Redis.html">
            
                <a href="Redis.html">
            
                    
                    Redis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="SpringCloud.html">
            
                <a href="SpringCloud.html">
            
                    
                    Spring Cloud
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Spring注解驱动.html">
            
                <a href="Spring注解驱动.html">
            
                    
                    Spring注解驱动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="SSM.html">
            
                <a href="SSM.html">
            
                    
                    SSM
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >JUC</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="juc">JUC</h1>
<h2 id="1-saleticket">1 SaleTicket</h2>
<p>&#x6838;&#x5FC3;&#xFF1A;&#x5728;&#x9AD8;&#x5185;&#x805A;&#x4F4E;&#x8026;&#x5408;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;<code>&#x7EBF;&#x7A0B;</code>  <code>&#x64CD;&#x4F5C;</code>  <code>&#x8D44;&#x6E90;&#x7C7B;</code></p>
<blockquote>
<p>&#x5BF9;&#x4E8E;&#x8D44;&#x6E90;&#x7C7B;&#x7684;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x4FDD;&#x5B58;&#x5728;&#x8D44;&#x6E90;&#x5185;&#x90E8;</p>
<p>&#x7EBF;&#x7A0B;&#x53EA;&#x662F;&#x5BF9;&#x8D44;&#x6E90;&#x5DF2;&#x7ECF;&#x5C01;&#x88C5;&#x597D;&#x7684;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x8C03;&#x7528;</p>
</blockquote>
<h3 id="11-&#x8D44;&#x6E90;&#x7C7B;">1.1 &#x8D44;&#x6E90;&#x7C7B;</h3>
<pre><code class="lang-java"><span class="hljs-meta">@Slf</span>4j
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ticket</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">1000</span>;

    Lock lock = <span class="hljs-keyword">new</span> ReentrantLock();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sell</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (num &gt; <span class="hljs-number">0</span>) {
                log.info(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5356;&#x51FA;&#x7B2C;&quot;</span> + num-- + <span class="hljs-string">&quot;&#x5F20;&#x7968;&#xFF0C;&#x8FD8;&#x5269;&#x4E0B;&quot;</span> + num + <span class="hljs-string">&quot;&#x5F20;&#x7968;&quot;</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<blockquote>
<p>&#x8D44;&#x6E90;&#x7C7B;&#x4E2D;&#x5305;&#x542B;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x4EE5;&#x53CA;&#x5BF9;&#x8D44;&#x6E90;&#x64CD;&#x4F5C;&#x7684;&#x5C01;&#x88C5;</p>
</blockquote>
<h3 id="12-&#x7EBF;&#x7A0B;">1.2 &#x7EBF;&#x7A0B;</h3>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SaleSystem</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        Ticket ticket = <span class="hljs-keyword">new</span> Ticket();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                ticket.sell();
            }
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                ticket.sell();
            }
        },<span class="hljs-string">&quot;B&quot;</span>).start();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                ticket.sell();
            }
        },<span class="hljs-string">&quot;C&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x521B;&#x5EFA;&#x8D44;&#x6E90;&#x7C7B;&#xFF0C;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x7528;&#x4E8E;&#x64CD;&#x4F5C;&#x8D44;&#x6E90;&#x7C7B;</p>
</blockquote>
<h2 id="2-&#x751F;&#x4EA7;&#x8005;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x578B;">2 &#x751F;&#x4EA7;&#x8005;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x578B;</h2>
<p>&#x6838;&#x5FC3;&#xFF1A;&#x591A;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x901A;&#x4FE1;&#xFF0C;&#x4E3B;&#x8981;&#x6B65;&#x9AA4;&#xFF1A;</p>
<ul>
<li>&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x662F;&#x5426;&#x6210;&#x7ACB;&#xFF0C;&#x6210;&#x7ACB;&#x5C31;&#x963B;&#x585E;</li>
<li>&#x4E0D;&#x6210;&#x7ACB;&#x5219;&#x6267;&#x884C;&#x64CD;&#x4F5C;</li>
<li>&#x6267;&#x884C;&#x5B8C;&#x64CD;&#x4F5C;&#x5524;&#x9192;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;</li>
</ul>
<h3 id="21-&#x4E00;&#x822C;&#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x578B;">2.1 &#x4E00;&#x822C;&#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x578B;</h3>
<h4 id="211-&#x8D44;&#x6E90;&#x7C7B;">2.1.1 &#x8D44;&#x6E90;&#x7C7B;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Slf</span>4j
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Resource</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">if</span> (num != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.wait();
        }
        num++;
        log.info(Thread.currentThread().getName() + num);
        <span class="hljs-keyword">this</span>.notifyAll();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">if</span> (num == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.wait();
        }
        num--;
        log.info(Thread.currentThread().getName() + num);
        <span class="hljs-keyword">this</span>.notifyAll();
    }
}
</code></pre>
<blockquote>
<p>&#x901A;&#x8FC7;synchronized&#x5173;&#x952E;&#x5B57;&#x5BF9;&#x6574;&#x4E2A;&#x65B9;&#x6CD5;&#x52A0;&#x9501;&#xFF0C;&#x901A;&#x8FC7;if&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x963B;&#x585E;&#x8BE5;&#x7EBF;&#x7A0B;&#xFF0C;&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6CA1;&#x6709;&#x963B;&#x585E;&#xFF0C;&#x5728;&#x6267;&#x884C;&#x5B8C;&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#x5524;&#x9192;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;</p>
</blockquote>
<h4 id="212-&#x7EBF;&#x7A0B;">2.1.2 &#x7EBF;&#x7A0B;</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Processor</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        Resource resource = <span class="hljs-keyword">new</span> Resource();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
                    resource.increment();
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
        },<span class="hljs-string">&quot;&#x751F;&#x4EA7;&#x8005;&quot;</span>).start();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
                    resource.decrement();
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
        },<span class="hljs-string">&quot;&#x6D88;&#x8D39;&#x8005;&quot;</span>).start();
    }
}
</code></pre>
<p>&#x901A;&#x8FC7;&#x7ED3;&#x679C;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x4F20;&#x7EDF;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x578B;</p>
<p><code>&#x4F46;&#x662F;&#x601D;&#x8003;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x73B0;&#x5728;&#x5B58;&#x5728;&#x591A;&#x4E2A;&#x751F;&#x4EA7;&#x8005;&#x548C;&#x6D88;&#x8D39;&#x8005;&#x4F1A;&#x51FA;&#x73B0;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x5462;&#xFF1F;</code></p>
<blockquote>
<p>&#x591A;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#x8FC7;&#x7A0B;&#x4E2D;&#x5982;&#x679C;&#x5728;&#x5BF9;&#x6761;&#x4EF6;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x662F;if&#x6761;&#x4EF6;&#xFF0C;&#x5C31;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x865A;&#x5047;&#x5524;&#x9192;</p>
<p>&#x8003;&#x8651;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x6700;&#x521D;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#x4E3A;0&#xFF0C;&#x90A3;&#x4E48;&#x4E24;&#x4E2A;&#x6D88;&#x8D39;&#x8005;&#x7EBF;&#x7A0B;&#x90FD;&#x4F1A;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;&#x5047;&#x8BBE;&#x751F;&#x4EA7;&#x8005;A&#x5148;&#x62A2;&#x5230;CPU&#xFF0C;&#x5219;&#x5224;&#x65AD;&#x901A;&#x8FC7;&#x4E4B;&#x540E;&#x64CD;&#x4F5C;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#x4E3A;1&#xFF0C;&#x8FD9;&#x65F6;&#x6D88;&#x8D39;&#x8005;A&#x548C;B&#x5B9E;&#x9645;&#x4E0A;&#x90FD;&#x662F;&#x4ECE;&#x963B;&#x585E;&#x4E2D;&#x88AB;&#x5524;&#x9192;&#xFF0C;&#x518D;&#x5047;&#x8BBE;&#x6D88;&#x8D39;&#x8005;A&#x5148;&#x62A2;&#x5230;CPU&#xFF0C;&#x5219;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x53E6;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#x53D8;&#x4E3A;0&#xFF0C;&#x4E4B;&#x540E;&#x6D88;&#x8D39;&#x8005;B&#x62A2;&#x5230;CPU&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x662F;if&#x5224;&#x65AD;&#xFF0C;&#x6545;&#x5BF9;&#x4E8E;&#x6D88;&#x8D39;&#x8005;B&#x5DF2;&#x7ECF;&#x7ECF;&#x8FC7;&#x4E86;&#x5224;&#x65AD;&#xFF0C;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x4EE4;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#x53D8;&#x4E3A;-1</p>
</blockquote>
<p>&#x6545;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x901A;&#x4FE1;&#x4E2D;&#xFF0C;&#x5BF9;&#x4E34;&#x754C;&#x6761;&#x4EF6;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x65F6;&#x4E00;&#x5B9A;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;if&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;while</p>
<h4 id="213-&#x4F18;&#x5316;&#x8D44;&#x6E90;&#x7C7B;">2.1.3 &#x4F18;&#x5316;&#x8D44;&#x6E90;&#x7C7B;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Slf</span>4j
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Resource</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">while</span> (num != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.wait();
        }
        num++;
        log.info(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t&quot;</span> + num);
        <span class="hljs-keyword">this</span>.notifyAll();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        <span class="hljs-keyword">while</span> (num == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">this</span>.wait();
        }
        num--;
        log.info(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t&quot;</span> + num);
        <span class="hljs-keyword">this</span>.notifyAll();
    }
}
</code></pre>
<h3 id="22-&#x65B0;&#x7248;&#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x578B;">2.2 &#x65B0;&#x7248;&#x751F;&#x4EA7;&#x6D88;&#x8D39;&#x6A21;&#x578B;</h3>
<h4 id="211-&#x8D44;&#x6E90;&#x7C7B;">2.1.1 &#x8D44;&#x6E90;&#x7C7B;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Slf</span>4j
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Resource</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;
    Lock lock = <span class="hljs-keyword">new</span> ReentrantLock();
    Condition condition = lock.newCondition();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (num != <span class="hljs-number">0</span>) {
                condition.await();
            }
            num++;
            log.info(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t&quot;</span> + num);
            condition.signalAll();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (num == <span class="hljs-number">0</span>) {
                condition.await();
            }
            num--;
            log.info(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t&quot;</span> + num);
            condition.signalAll();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<blockquote>
<p>Condition&#x63A5;&#x53E3;&#x5B9E;&#x4F8B;&#x548C;Lock&#x5B9E;&#x4F8B;&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Condition&#x5B9E;&#x4F8B;&#x5BF9;&#x6301;&#x6709;&#x9501;&#x548C;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#x7684;&#x4EE3;&#x7801;&#x5757;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>
<p>Condition&#x63A5;&#x53E3;&#x5B9E;&#x4F8B;&#x7B49;&#x540C;&#x4E8E;&#x66FF;&#x6362;&#x4E86;&#x5BF9;&#x8C61;&#x76D1;&#x89C6;&#x5668;(Object monitor)&#x65B9;&#x6CD5;(wait,notify,notifyAll)&#xFF0C;&#x66FF;&#x6362;&#x4E3A;(await,sign,signAll)</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x5F53;while&#x5224;&#x65AD;&#x6761;&#x4EF6;&#x6210;&#x7ACB;&#x65F6;&#xFF0C;await&#x65B9;&#x6CD5;&#x4E5F;&#x4F1A;&#x7C7B;&#x4F3C;&#x4E8E;wait&#x65B9;&#x6CD5;<code>&#x91CA;&#x653E;&#x9501;</code>(&#x6CE8;&#x610F;&#xFF1A;<code>sleep&#x65B9;&#x6CD5;&#x867D;&#x7136;&#x963B;&#x585E;&#x4F46;&#x662F;&#x4E0D;&#x4F1A;&#x91CA;&#x653E;&#x9501;</code>)</p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5916;&#x90E8;&#x7684;lock&#x9501;&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x4E92;&#x65A5;&#xFF0C;&#x800C;&#x5185;&#x90E8;&#x7684;condition&#x662F;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x540C;&#x6B65;</p>
</blockquote>
<h3 id="23-lock&#x9501;&#x5B9E;&#x73B0;&#x7CBE;&#x786E;&#x901A;&#x77E5;&#x987A;&#x5E8F;">2.3 Lock&#x9501;&#x5B9E;&#x73B0;&#x7CBE;&#x786E;&#x901A;&#x77E5;&#x987A;&#x5E8F;</h3>
<h4 id="231-&#x8D44;&#x6E90;&#x7C7B;">2.3.1 &#x8D44;&#x6E90;&#x7C7B;</h4>
<pre><code class="lang-java"><span class="hljs-meta">@Slf</span>4j
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Resource2</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> number = <span class="hljs-number">1</span>;

    <span class="hljs-keyword">private</span> Lock lock = <span class="hljs-keyword">new</span> ReentrantLock();
    <span class="hljs-keyword">private</span> Condition condition1 = lock.newCondition();
    <span class="hljs-keyword">private</span> Condition condition2 = lock.newCondition();
    <span class="hljs-keyword">private</span> Condition condition3 = lock.newCondition();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print5</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (number != <span class="hljs-number">1</span>) {
                condition1.await();
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                System.out.println(Thread.currentThread().getName());
            }
            number = <span class="hljs-number">2</span>;
            condition2.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print10</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (number != <span class="hljs-number">2</span>) {
                condition2.await();
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                System.out.println(Thread.currentThread().getName());
            }
            number = <span class="hljs-number">3</span>;
            condition3.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">print15</span><span class="hljs-params">()</span> </span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (number != <span class="hljs-number">3</span>) {
                condition3.await();
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) {
                System.out.println(Thread.currentThread().getName());
            }
            number = <span class="hljs-number">1</span>;
            condition1.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
</code></pre>
<blockquote>
<p>&#x540C;&#x4E00;&#x4E2A;lock&#x5BF9;&#x8C61;&#xFF0C;&#x4F46;&#x662F;&#x4ECE;lock&#x5BF9;&#x8C61;&#x4E2D;&#x6620;&#x5C04;&#x51FA;&#x4E09;&#x4E2A;condition&#x5BF9;&#x8C61;(&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x628A;&#x9501;&#x591A;&#x4E2A;&#x94A5;&#x5319;)</p>
<p>&#x5728;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#x65F6;&#x5982;&#x679C;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x5C31;&#x7528;&#x81EA;&#x5DF1;&#x7684;&#x94A5;&#x5319;&#x4E0A;&#x9501;&#xFF0C;&#x5F53;&#x4E0D;&#x6EE1;&#x8DB3;&#x65F6;&#x5C31;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#x8C03;&#x7528;&#x6307;&#x5B9A;&#x94A5;&#x5319;&#x53BB;&#x5F00;&#x9501;(&#x4E5F;&#x5C31;&#x662F;&#x5524;&#x9192;&#x6307;&#x5B9A;&#x7684;&#x64CD;&#x4F5C;)</p>
</blockquote>
<h4 id="232-&#x7EBF;&#x7A0B;">2.3.2 &#x7EBF;&#x7A0B;</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Processor</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        Resource2 resource2 = <span class="hljs-keyword">new</span> Resource2();

        <span class="hljs-keyword">new</span> Thread(resource2::print5,<span class="hljs-string">&quot;A&quot;</span>).start();

        <span class="hljs-keyword">new</span> Thread(resource2::print10,<span class="hljs-string">&quot;B&quot;</span>).start();

        <span class="hljs-keyword">new</span> Thread(resource2::print15,<span class="hljs-string">&quot;C&quot;</span>).start();
    }
}
</code></pre>
<h2 id="3-&#x516B;&#x9501;&#x73B0;&#x8C61;">3 &#x516B;&#x9501;&#x73B0;&#x8C61;</h2>
<p>&#x5047;&#x8BBE;&#x73B0;&#x5728;&#x6709;&#x4E00;&#x4E2A;Phone&#x8D44;&#x6E90;&#x7C7B;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E24;&#x79CD;&#x64CD;&#x4F5C;&#x65B9;&#x5F0F;</p>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Phone</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;sendEmail...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSms</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;sendSms...&quot;</span>);
    }
}
</code></pre>
<h3 id="31-&#x6807;&#x51C6;&#x8BBF;&#x95EE;">3.1 &#x6807;&#x51C6;&#x8BBF;&#x95EE;</h3>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(phone::sendEmail,<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(phone::sendSms,<span class="hljs-string">&quot;B&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x5F53;&#x7EBF;&#x7A0B;A&#x5C31;&#x7EEA;&#x4E4B;&#x540E;&#xFF0C;main&#x7EBF;&#x7A0B;&#x4F11;&#x7720;2&#x79D2;&#x949F;&#x4E4B;&#x540E;&#xFF0C;&#x624D;&#x4EE4;B&#x7EBF;&#x7A0B;&#x5C31;&#x7EEA;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x5B9A;&#x4F1A;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#x518D;&#x6253;&#x5370;&#x77ED;&#x4FE1;</p>
</blockquote>
<h3 id="32-&#x90AE;&#x4EF6;&#x65B9;&#x6CD5;&#x4F11;&#x7720;4&#x79D2;&#x949F;">3.2 &#x90AE;&#x4EF6;&#x65B9;&#x6CD5;&#x4F11;&#x7720;4&#x79D2;&#x949F;</h3>
<p>&#x4FEE;&#x6539;&#x8D44;&#x6E90;&#x7C7B;</p>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Phone</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">&quot;sendEmail...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSms</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;sendSms...&quot;</span>);
    }
}
</code></pre>
<p>&#x6267;&#x884C;&#x7EBF;&#x7A0B;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(phone::sendEmail,<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(phone::sendSms,<span class="hljs-string">&quot;B&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x662F;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#xFF0C;&#x867D;&#x7136;&#x90AE;&#x4EF6;&#x7761;&#x7720;4&#x79D2;&#x949F;</p>
<p>&#x7136;&#x800C;&#x7531;&#x4E8E;main&#x7EBF;&#x7A0B;&#x4F11;&#x7720;2&#x79D2;&#x949F;&#xFF0C;&#x8FD9;&#x662F;&#x90AE;&#x4EF6;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x62A2;&#x593A;&#x5230;&#x6267;&#x884C;&#x6743;&#xFF0C;&#x5E76;&#x4E14;&#x52A0;&#x9501;&#xFF1B;&#x800C;slepp&#x65B9;&#x6CD5;&#x4E0D;&#x4F1A;&#x91CA;&#x653E;&#x9501;</p>
</blockquote>
<h3 id="33-&#x65B0;&#x589E;&#x666E;&#x901A;&#x65B9;&#x6CD5;hello&#xFF0C;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#x8FD8;&#x662F;hello">3.3 &#x65B0;&#x589E;&#x666E;&#x901A;&#x65B9;&#x6CD5;hello()&#xFF0C;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#x8FD8;&#x662F;hello</h3>
<p>&#x4FEE;&#x6539;&#x8D44;&#x6E90;&#x7C7B;</p>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Phone</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">&quot;sendEmail...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSms</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;sendSms...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;hello...&quot;</span>);
    }
}
</code></pre>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x7684;hello&#x65B9;&#x6CD5;&#x5E76;&#x6CA1;&#x6709;&#x52A0;&#x9501;</p>
</blockquote>
<p>&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(phone::sendEmail,<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(phone::hello,<span class="hljs-string">&quot;B&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x7ED3;&#x679C;&#x662F;&#x5148;&#x6253;&#x5370;hello&#xFF0C;&#x518D;&#x6253;&#x5370;&#x90AE;&#x4EF6;</p>
<p>&#x56E0;&#x4E3A;&#x90AE;&#x4EF6;&#x7EBF;&#x7A0B;&#x867D;&#x7136;&#x6267;&#x884C;&#x65F6;&#x5148;&#x62A2;&#x5230;&#x9501;&#xFF0C;&#x7136;&#x800C;hello&#x7EBF;&#x7A0B;&#x5E76;&#x6CA1;&#x6709;&#x4E0A;&#x9501;&#xFF0C;&#x53EA;&#x7528;&#x7B49;&#x5F85;main&#x7EBF;&#x7A0B;&#x4F11;&#x7720;2&#x79D2;&#x949F;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5C31;&#x7EEA;--&#x8FD0;&#x884C;</p>
</blockquote>
<h3 id="34-&#x4E24;&#x90E8;&#x624B;&#x673A;&#xFF0C;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#x8FD8;&#x662F;&#x77ED;&#x4FE1;">3.4 &#x4E24;&#x90E8;&#x624B;&#x673A;&#xFF0C;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#x8FD8;&#x662F;&#x77ED;&#x4FE1;</h3>
<p>&#x8D44;&#x6E90;&#x7C7B;&#x4E0D;&#x53D8;&#xFF0C;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();
        Phone phone2 = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(phone::sendEmail,<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(phone2::sendSms,<span class="hljs-string">&quot;B&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x7ED3;&#x679C;&#x662F;&#x5148;&#x6253;&#x5370;&#x77ED;&#x4FE1;&#xFF0C;&#x518D;&#x6253;&#x5370;&#x90AE;&#x4EF6;</p>
<p>&#x56E0;&#x4E3A;&#x4E24;&#x90E8;&#x624B;&#x673A;&#x5B58;&#x5728;&#x4E24;&#x628A;&#x9501;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x7684;&#x9501;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x90AE;&#x4EF6;&#x7EBF;&#x7A0B;&#x53CA;&#x65F6;&#x4F11;&#x7720;&#x4E0D;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x4E5F;&#x4E0D;&#x59A8;&#x788D;&#x77ED;&#x4FE1;&#x7EBF;&#x7A0B;</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x91CC;&#x7684;&#x9501;&#x662F;<code>&#x5BF9;&#x8C61;&#x9501;</code>&#xFF0C;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;Phone&#x5BF9;&#x8C61;&#x6301;&#x6709;&#x7684;&#x5BF9;&#x8C61;&#x9501;&#x4E5F;&#x4E0D;&#x540C;</p>
</blockquote>
<h3 id="35-&#x4E24;&#x4E2A;&#x9759;&#x6001;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x4E00;&#x90E8;&#x624B;&#x673A;">3.5 &#x4E24;&#x4E2A;&#x9759;&#x6001;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x540C;&#x4E00;&#x90E8;&#x624B;&#x673A;</h3>
<p>&#x4FEE;&#x6539;&#x8D44;&#x6E90;&#x7C7B;</p>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Phone</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">&quot;sendEmail...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSms</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;sendSms...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;hello...&quot;</span>);
    }
}
</code></pre>
<p>&#x4FEE;&#x6539;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone.sendEmail();
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone.sendSms();
        },<span class="hljs-string">&quot;A&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x7ED3;&#x679C;&#x662F;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#xFF0C;&#x518D;&#x6253;&#x5370;&#x77ED;&#x4FE1;</p>
<p>&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x62FF;&#x5230;&#x7684;&#x540C;&#x6B65;&#x9501;&#x5B9E;&#x9645;&#x4E0A;Phone&#x7C7B;&#x7684;class&#x5BF9;&#x8C61;&#xFF0C;&#x4E0D;&#x7BA1;&#x600E;&#x4E48;&#x6837;&#x90FD;&#x53EA;&#x6709;&#x552F;&#x4E00;&#x4E00;&#x4E2A;</p>
</blockquote>
<h3 id="36-&#x4E24;&#x4E2A;&#x9759;&#x6001;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4E24;&#x90E8;&#x624B;&#x673A;">3.6 &#x4E24;&#x4E2A;&#x9759;&#x6001;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4E24;&#x90E8;&#x624B;&#x673A;</h3>
<p>&#x4FEE;&#x6539;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();
        Phone phone2 = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone.sendEmail();
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone2.sendSms();
        },<span class="hljs-string">&quot;A&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x7ED3;&#x679C;&#x4F9D;&#x7136;&#x662F;&#x5148;&#x6253;&#x5370;&#x90AE;&#x4EF6;&#xFF0C;&#x518D;&#x6253;&#x5370;&#x77ED;&#x4FE1;</p>
<p>&#x56E0;&#x4E3A;&#x540C;&#x6B65;&#x9501;&#x662F;Phone&#x7C7B;&#x7684;class&#x5BF9;&#x8C61;</p>
</blockquote>
<h3 id="37-&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x3001;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4E24;&#x90E8;&#x624B;&#x673A;">3.7 &#x4E00;&#x4E2A;&#x666E;&#x901A;&#x3001;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4E24;&#x90E8;&#x624B;&#x673A;</h3>
<p>&#x4FEE;&#x6539;&#x8D44;&#x6E90;&#x7C7B;</p>
<pre><code class="lang-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Phone</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">&quot;sendEmail...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSms</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;sendSms...&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span> </span>{
        System.out.println(<span class="hljs-string">&quot;hello...&quot;</span>);
    }
}
</code></pre>
<p>&#x4FEE;&#x6539;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone.sendEmail();
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone.sendSms();
        },<span class="hljs-string">&quot;A&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x7ED3;&#x679C;&#x662F;&#x5148;&#x6253;&#x5370;&#x77ED;&#x4FE1;&#xFF0C;&#x518D;&#x6253;&#x5370;&#x90AE;&#x4EF6;</p>
<p>&#x56E0;&#x4E3A;&#x77ED;&#x4FE1;&#x7EBF;&#x7A0B;&#x62FF;&#x5230;&#x7684;&#x662F;phone&#x7684;&#x5BF9;&#x8C61;&#x9501;&#xFF0C;&#x800C;&#x90AE;&#x4EF6;&#x7EBF;&#x7A0B;&#x62FF;&#x5230;&#x7684;&#x662F;Phone&#x7C7B;&#x7684;class&#x5BF9;&#x8C61;&#x9501;&#xFF0C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x4E92;&#x4E0D;&#x5E72;&#x6270;</p>
</blockquote>
<h3 id="38-&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x3001;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4E24;&#x90E8;&#x624B;&#x673A;">3.8 &#x4E00;&#x4E2A;&#x9759;&#x6001;&#x3001;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x4E24;&#x90E8;&#x624B;&#x673A;</h3>
<p>&#x4FEE;&#x6539;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock8</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        Phone phone = <span class="hljs-keyword">new</span> Phone();
        Phone phone2 = <span class="hljs-keyword">new</span> Phone();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone.sendEmail();
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>);

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            phone2.sendSms();
        },<span class="hljs-string">&quot;A&quot;</span>).start();
    }
}
</code></pre>
<blockquote>
<p>&#x7ED3;&#x679C;&#x4F9D;&#x7136;&#x662F;&#x5148;&#x6253;&#x5370;&#x77ED;&#x4FE1;&#xFF0C;&#x518D;&#x6253;&#x5370;&#x90AE;&#x4EF6;</p>
<p>&#x56E0;&#x4E3A;&#x672C;&#x8D28;&#x4E0A;&#x90AE;&#x4EF6;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x7684;&#x662F;class&#x5BF9;&#x8C61;&#x9501;&#xFF0C;&#x800C;&#x77ED;&#x4FE1;&#x7EBF;&#x7A0B;&#x6301;&#x6709;&#x7684;&#x662F;phone2&#x5BF9;&#x8C61;&#x9501;</p>
</blockquote>
<h2 id="4-&#x96C6;&#x5408;&#x5206;&#x6790;">4 &#x96C6;&#x5408;&#x5206;&#x6790;</h2>
<h3 id="41-arraylist&#x5206;&#x6790;">4.1 ArrayList&#x5206;&#x6790;</h3>
<p>&#x5047;&#x8BBE;&#x4E00;&#x79CD;&#x573A;&#x666F;&#xFF0C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ArrayList&#xFF0C;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotSafeDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        List&lt;String&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) {
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                list.add(UUID.randomUUID().toString().substring(<span class="hljs-number">0</span>,<span class="hljs-number">8</span>));
                System.out.println(list);
            },String.valueOf(i)).start();
        }
    }
}
</code></pre>
<blockquote>
<p>&#x901A;&#x8FC7;for&#x5FAA;&#x73AF;&#x5EFA;&#x7ACB;&#x4E86;30&#x4E2A;&#x7EBF;&#x7A0B;&#x5BF9;list&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;ArrayList&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B58;&#x5728;&#x968F;&#x673A;&#x6027;&#xFF0C;&#x53EF;&#x80FD;&#x67D0;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E5F;&#x5728;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;</p>
</blockquote>
<p>&#x6240;&#x4EE5;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x62A5;&#x51FA;<code>ConcurrentModificationException</code>(&#x5E76;&#x53D1;&#x4FEE;&#x6539;&#x5F02;&#x5E38;)</p>
<pre><code class="lang-bash">Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;8&quot;</span> Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;20&quot;</span> Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;15&quot;</span> Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;21&quot;</span> Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;23&quot;</span> Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;28&quot;</span> java.util.ConcurrentModificationException
</code></pre>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x5462;&#xFF1F;(&#x6216;&#x8005;&#x8BF4;&#x4E3A;&#x4EC0;&#x4E48;AarrayList&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#x5462;)</p>
<p>&#x5206;&#x6790;&#x4E0B;ArrayList&#x7684;&#x6E90;&#x7801;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, E element)</span> </span>{
    rangeCheckForAdd(index);

    ensureCapacityInternal(size + <span class="hljs-number">1</span>);  <span class="hljs-comment">// Increments modCount!!</span>
    System.arraycopy(elementData, index, elementData, index + <span class="hljs-number">1</span>,size - index);
    elementData[index] = element;
    size++;
}
</code></pre>
<blockquote>
<p>add&#x65B9;&#x6CD5;&#x672C;&#x8EAB;&#x6CA1;&#x6709;&#x52A0;&#x9501;&#xFF0C;&#x5728;&#x9AD8;&#x5E76;&#x53D1;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x8BFB;&#x5199;</p>
</blockquote>
<p>Vector&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
    modCount++;
    ensureCapacityHelper(elementCount + <span class="hljs-number">1</span>);
    elementData[elementCount++] = e;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
}
</code></pre>
<blockquote>
<p>add&#x65B9;&#x6CD5;&#x901A;&#x8FC7;synchronized&#x5173;&#x952E;&#x5B57;&#x52A0;&#x9501;&#xFF0C;&#x4FDD;&#x8BC1;&#x4E86;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x53EA;&#x80FD;&#x963B;&#x585E;</p>
</blockquote>
<p>&#x7136;&#x800C;&#x867D;&#x7136;&#x4FDD;&#x8BC1;&#x4E86;&#x7EBF;&#x7A0B;&#x7684;&#x5B89;&#x5168;&#xFF0C;&#x5374;&#x6781;&#x5927;&#x7684;&#x964D;&#x4F4E;&#x4E86;&#x6548;&#x7387;(&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;vector&#x4E0D;&#x5E38;&#x7528;&#x7684;&#x539F;&#x56E0;)</p>
<h4 id="411-&#x901A;&#x8FC7;collectionssynchronizedlist&#x4F18;&#x5316;">4.1.1 &#x901A;&#x8FC7;Collections.synchronizedList&#x4F18;&#x5316;</h4>
<p>&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;ArrayList&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;&#xFF0C;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x8BE5;&#x95EE;&#x9898;&#x5462;&#xFF1F;</p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Collections.synchronizedList(new ArrayList&lt;&gt;())</code>&#x64CD;&#x4F5C;&#x539F;&#x6709;&#x7684;ArrayList&#x4F7F;&#x5F97;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</p>
<p><code>synchronizedList</code>&#x65B9;&#x6CD5;&#x662F;&#x5982;&#x4F55;&#x6267;&#x884C;&#x7684;&#x5462;&#xFF1F;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">synchronizedList</span><span class="hljs-params">(List&lt;T&gt; list)</span> </span>{
    <span class="hljs-keyword">return</span> (list <span class="hljs-keyword">instanceof</span> RandomAccess ?
            <span class="hljs-keyword">new</span> SynchronizedRandomAccessList&lt;&gt;(list) :
            <span class="hljs-keyword">new</span> SynchronizedList&lt;&gt;(list));
}
</code></pre>
<blockquote>
<p>&#x9996;&#x5148;&#x5224;&#x65AD;&#x53C2;&#x6570;&#x4E2D;&#x7684;list&#x662F;&#x5426;&#x5C5E;&#x4E8E;RandomAccess&#x63A5;&#x53E3;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#x5BF9;&#x8C61;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x5426;&#x8FD4;&#x56DE;&#x7684;&#x5B9E;&#x9645;&#x4E0A;&#x90FD;&#x662F;&#x52A0;&#x9501;&#x7684;&#x5BF9;&#x8C61;</p>
</blockquote>
<h4 id="412-&#x521B;&#x5EFA;copyonwritearraylist&#x5BF9;&#x8C61;">4.1.2 &#x521B;&#x5EFA;CopyOnWriteArrayList&#x5BF9;&#x8C61;</h4>
<p>&#x5355;&#x7EBF;&#x7A0B;&#x65F6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;ArrayList&#xFF0C;&#x9AD8;&#x5E76;&#x53D1;&#x5219;&#x4F7F;&#x7528;CopyOnWriteArrayList</p>
<p>&#x90A3;&#x4E48;&#x4E3A;&#x4EC0;&#x4E48;CopyOnWriteArrayList&#x5728;&#x9AD8;&#x5E76;&#x53D1;&#x60C5;&#x51B5;&#x4E0B;&#x4F7F;&#x7528;&#x5462;&#xFF1F;</p>
<blockquote>
<p>&#x56E0;&#x4E3A;CopyOnWriteArrayList&#x4E0D;&#x4EC5;&#x80FD;&#x5728;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x8FBE;&#x5230;&#x6570;&#x636E;&#x7684;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x90A3;&#x4E48;&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x5462;&#xFF1F;</p>
</blockquote>
<p>1&#x3001;&#x9996;&#x5148;CopyOnWriteArrayList&#x4E2D;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x548C;&#x4E00;&#x4E2A;lock&#x9501;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124203201667.png" alt="image-20210124203201667"></p>
<p>2&#x3001;&#x5F53;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x65F6;</p>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Appends the specified element to the end of this list.
 *
 * <span class="hljs-doctag">@param</span> e element to be appended to this list
 * <span class="hljs-doctag">@return</span> {<span class="hljs-doctag">@code</span> true} (as specified by {<span class="hljs-doctag">@link</span> Collection#add})
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
    <span class="hljs-keyword">final</span> ReentrantLock lock = <span class="hljs-keyword">this</span>.lock;
    lock.lock();
    <span class="hljs-keyword">try</span> {
        Object[] elements = getArray();
        <span class="hljs-keyword">int</span> len = elements.length;
        Object[] newElements = Arrays.copyOf(elements, len + <span class="hljs-number">1</span>);
        newElements[len] = e;
        setArray(newElements);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<blockquote>
<p>&#x9996;&#x9009;&#x62FF;&#x51FA;&#x7C7B;&#x4E2D;&#x7EF4;&#x62A4;&#x7684;lock&#x9501;&#x5E76;&#x4E0A;&#x9501;&#xFF0C;&#x4E4B;&#x540E;&#x83B7;&#x53D6;&#x5230;&#x5F53;&#x524D;&#x7684;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;<code>Arrays.copyOf</code>&#x65B9;&#x6CD5;&#x590D;&#x5236;&#x4E86;&#x5F53;&#x524D;&#x7684;&#x6570;&#x7EC4;&#x5E76;&#x4F7F;&#x957F;&#x5EA6;&#x52A0;1&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6DFB;&#x52A0;&#x7684;&#x5143;&#x7D20;&#x653E;&#x5165;&#x6570;&#x7EC4;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x8FC7;set&#x65B9;&#x6CD5;&#x5C06;&#x65B0;&#x7684;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x8FD4;&#x56DE;&#xFF1B;&#x7136;&#x540E;&#x518D;&#x89E3;&#x9501;</p>
<p>&#x6838;&#x5FC3;&#x70B9;&#xFF1A;</p>
<p>1&#x3001;&#x590D;&#x5236;&#x539F;&#x6709;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x4E0D;&#x5F71;&#x54CD;&#x8BFB;&#x64CD;&#x4F5C;</p>
<p>2&#x3001;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#x52A0;&#x9501;</p>
</blockquote>
<p>3&#x3001;&#x5F53;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x65F6;</p>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * {<span class="hljs-doctag">@inheritDoc</span>}
 *
 * <span class="hljs-doctag">@throws</span> IndexOutOfBoundsException {<span class="hljs-doctag">@inheritDoc</span>}
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> E <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span>{
    <span class="hljs-keyword">return</span> get(getArray(), index);
}
</code></pre>
<blockquote>
<p>&#x8BFB;&#x6570;&#x636E;&#x65F6;&#x5E76;&#x6CA1;&#x6709;&#x52A0;&#x9501;&#xFF0C;&#x867D;&#x7136;&#x4E0D;&#x662F;&#x5373;&#x65F6;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x65B0;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x800C;&#x4E5F;&#x4FDD;&#x8BC1;&#x4E86;&#x6570;&#x636E;&#x7684;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;</p>
</blockquote>
<h3 id="42-hashset&#x5206;&#x6790;">4.2 HashSet&#x5206;&#x6790;</h3>
<p>&#x7C7B;&#x4F3C;&#x4E8E;Arraylist&#xFF0C;HashSet&#x540C;&#x6837;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;</p>
<p>&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Collections.synchronizedSet()</code>&#x4EE4;&#x539F;&#x6709;&#x7684;HashSet&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x7136;&#x800C;&#x8FD9;&#x6837;&#x4F1A;&#x6781;&#x5927;&#x964D;&#x4F4E;&#x8BFB;&#x5199;&#x6548;&#x7387;</p>
<p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>new CopyOnWriteArraySet&lt;&gt;()</code>&#x5728;&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x63D0;&#x9AD8;&#x8BFB;&#x5199;&#x6548;&#x7387;</p>
<h4 id="421-&#x6269;&#x5C55;">4.2.1 &#x6269;&#x5C55;</h4>
<p>&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x770B;&#x51FA;&#xFF0C;HashSet&#x5E95;&#x5C42;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;HashMap&#x548C;&#x4E00;&#x4E2A;Object&#x5BF9;&#x8C61;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124205019463.png" alt="image-20210124205019463"></p>
<p>&#x90A3;&#x4E48;&#x8FD9;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x7684;&#x4F5C;&#x7528;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HashSet</span><span class="hljs-params">()</span> </span>{
    map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
}
</code></pre>
<blockquote>
<p>&#x4ECE;HashSet&#x7684;&#x6784;&#x9020;&#x5668;&#x4E2D;&#x770B;&#x51FA;&#xFF0C;map&#x5C31;&#x662F;&#x4E00;&#x4E2A;HashMap&#x5BF9;&#x8C61;</p>
</blockquote>
<p>&#x5F53;&#x8C03;&#x7528;add&#x65B9;&#x6CD5;&#x65F6;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span> </span>{
    <span class="hljs-keyword">return</span> map.put(e, PRESENT)==<span class="hljs-keyword">null</span>;
}
</code></pre>
<p>&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x5411;map&#x4E2D;&#x653E;&#x6570;&#x636E;&#xFF0C;key&#x5C31;&#x662F;add&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x800C;value&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x503C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x5F00;&#x59CB;&#x7EF4;&#x62A4;&#x7684;Object&#x5BF9;&#x8C61;</p>
<p>&#x5F53;&#x8C03;&#x7528;remove&#x65B9;&#x6CD5;&#x65F6;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">remove</span><span class="hljs-params">(Object o)</span> </span>{
    <span class="hljs-keyword">return</span> map.remove(o)==PRESENT;
}
</code></pre>
<p>&#x672C;&#x8D28;&#x4E0A;&#x5C31;&#x662F;&#x4ECE;map&#x4E2D;&#x79FB;&#x9664;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#xFF0C;&#x6211;&#x4EEC;&#x77E5;&#x9053;map&#x7684;remove&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x5BF9;&#x5E94;key&#x7684;value&#xFF0C;&#x800C;value&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x503C;PRESENT</p>
<blockquote>
<p>&#x603B;&#x7ED3;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>1&#x3001;HashSet&#x5E95;&#x5C42;&#x5C31;&#x662F;HashMap&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x53EA;&#x4F7F;&#x7528;&#x4E86;HashMap&#x7684;key(&#x56E0;&#x4E3A;key&#x552F;&#x4E00;)&#xFF0C;&#x800C;value&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x56FA;&#x5B9A;&#x503C;Object&#x5BF9;&#x8C61;</p>
</blockquote>
<h3 id="43-hashmap&#x5206;&#x6790;">4.3 HashMap&#x5206;&#x6790;</h3>
<p>&#x7C7B;&#x4F3C;&#x4E8E;Arraylist&#xFF0C;HashMap&#x540C;&#x6837;&#x7EBF;&#x7A0B;&#x4E0D;&#x5B89;&#x5168;</p>
<p>&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>Collections.synchronizedMap()</code>&#x4EE4;&#x539F;&#x6709;&#x7684;HashMap&#x4FDD;&#x8BC1;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x7136;&#x800C;&#x8FD9;&#x6837;&#x4F1A;&#x6781;&#x5927;&#x964D;&#x4F4E;&#x8BFB;&#x5199;&#x6548;&#x7387;</p>
<p>&#x7136;&#x800C;&#x5E76;&#x4E0D;&#x5B58;&#x5728;<code>CopyOnWriteArrayMap&lt;&gt;()</code>&#xFF0C;&#x800C;&#x662F;<code>ConcurrentHashMap&lt;&gt;()</code></p>
<h4 id="431-concurrenthashmap&#x5206;&#x6790;">4.3.1 ConcurrentHashMap&#x5206;&#x6790;</h4>
<p>//TODO</p>
<h2 id="5-callable&#x63A5;&#x53E3;">5 Callable&#x63A5;&#x53E3;</h2>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x5982;&#x679C;&#x9700;&#x8981;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x5FC5;&#x987B;&#x901A;&#x8FC7;<code>new Thread()</code>&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;</p>
<p>&#x4F46;&#x662F;&#x53C2;&#x8003;&#x4E0B;Thread&#x7684;&#x6784;&#x9020;&#x5668;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124215034560.png" alt="image-20210124215034560"></p>
<p>&#x8FD8;&#x53EF;&#x4EE5;&#x5728;&#x6784;&#x9020;&#x5668;&#x4E2D;&#x4F20;&#x5165;Runable&#x63A5;&#x53E3;&#x6216;&#x8005;ThreadGroup&#x7EBF;&#x7A0B;&#x7EC4;</p>
<p>&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x4F7F;&#x7528;Callable&#x63A5;&#x53E3;&#x5462;&#xFF1F;</p>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x6784;&#x9020;&#x5668;&#x4E2D;&#x6CA1;&#x6709;Callable&#x63A5;&#x53E3;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x5FC5;&#x987B;&#x60F3;&#x529E;&#x6CD5;&#x5C06;Callable&#x63A5;&#x53E3;&#x548C;Thread&#x6784;&#x9020;&#x5668;&#x8054;&#x7CFB;&#x8D77;&#x6765;</p>
<p>&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x5C06;Runable&#x63A5;&#x53E3;&#x4F5C;&#x4E3A;&#x6865;&#x6881;&#x5C06;&#x4E24;&#x8FB9;&#x8054;&#x7CFB;&#x8D77;&#x6765;</p>
<p>&#x770B;&#x4E0B;Runbale&#x63A5;&#x53E3;&#x5728;API&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124215340440.png" alt="image-20210124215340440"></p>
<p>&#x5DF2;&#x77E5;&#x5B9E;&#x73B0;&#x7C7B;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;FutureTask&#x7C7B;&#xFF0C;&#x800C;FutureTask&#x7C7B;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x5462;&#xFF1F;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124215436046.png" alt="image-20210124215436046"></p>
<p>FutureTask&#x7C7B;&#x7684;&#x6784;&#x9020;&#x5668;&#x4E2D;&#x53EF;&#x4EE5;&#x4F20;&#x5165;&#x4E00;&#x4E2A;Callable&#x63A5;&#x53E3;&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x5C06;Callable&#x63A5;&#x53E3;&#x548C;Thread&#x8054;&#x7CFB;&#x5230;&#x4E00;&#x8D77;</p>
<h3 id="51-callable&#x63A5;&#x53E3;&#x6D4B;&#x8BD5;">5.1 Callable&#x63A5;&#x53E3;&#x6D4B;&#x8BD5;</h3>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallableDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>{
        FutureTask futureTask = <span class="hljs-keyword">new</span> FutureTask(<span class="hljs-keyword">new</span> MyThread());

        <span class="hljs-keyword">new</span> Thread(futureTask,<span class="hljs-string">&quot;A&quot;</span>).start();

        System.out.println(futureTask.get());
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        System.out.println(<span class="hljs-string">&quot;&#x7EBF;&#x7A0B;&#x88AB;&#x8C03;&#x7528;&quot;</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;
    }
}
</code></pre>
<blockquote>
<p>&#x9996;&#x5148;MyThread&#x7EE7;&#x627F;&#x4E86;Callable&#x63A5;&#x53E3;(&#x5E76;&#x6307;&#x5B9A;&#x6CDB;&#x578B;&#xFF0C;&#x6CDB;&#x578B;&#x5C31;&#x662F;call&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x7C7B;&#x578B;)</p>
<p>&#x7136;&#x540E;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;FutureTask&#x5BF9;&#x8C61;&#x4F20;&#x5165;MyThread&#x5BF9;&#x8C61;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x8FDB;&#x800C;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;</p>
<p>&#x6700;&#x540E;&#x8C03;&#x7528;&#x4E86;futureTask&#x7684;get&#x65B9;&#x6CD5;&#x83B7;&#x53D6;call&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x8FD4;&#x56DE;&#x503C;</p>
<p><code>&#x4E2A;&#x4EBA;&#x7406;&#x89E3;&#xFF1A;FutureTask&#x7C7B;(&#x4ECE;&#x540D;&#x5B57;&#x4E0A;&#x662F;&#x672A;&#x6765;&#x4EFB;&#x52A1;)&#xFF0C;&#x5F02;&#x6B65;&#x6267;&#x884C;&#xFF0C;&#x800C;get&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x5F02;&#x6B65;&#x6267;&#x884C;&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;</code></p>
</blockquote>
<h3 id="52-callable&#x63A5;&#x53E3;&#x548C;runable&#x63A5;&#x53E3;&#x7684;&#x533A;&#x522B;">5.2 Callable&#x63A5;&#x53E3;&#x548C;Runable&#x63A5;&#x53E3;&#x7684;&#x533A;&#x522B;</h3>
<table>
<thead>
<tr>
<th>Callable</th>
<th>Runable</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x65B9;&#x6CD5;&#x5B58;&#x5728;&#x8FD4;&#x56DE;&#x503C;(&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x662F;&#x5B9E;&#x73B0;Callable&#x63A5;&#x53E3;&#x65F6;&#x5B9A;&#x4E49;&#x7684;&#x6CDB;&#x578B;)</td>
<td>&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x503C;</td>
</tr>
<tr>
<td>&#x53EF;&#x4EE5;&#x629B;&#x5F02;&#x5E38;</td>
<td>&#x4E0D;&#x80FD;&#x629B;&#x5F02;&#x5E38;</td>
</tr>
<tr>
<td>&#x843D;&#x5730;&#x65B9;&#x6CD5;&#x4E3A;call&#x65B9;&#x6CD5;</td>
<td>&#x843D;&#x5730;&#x65B9;&#x6CD5;&#x4E3A;run&#x65B9;&#x6CD5;</td>
</tr>
</tbody>
</table>
<h3 id="53-callable&#x63A5;&#x53E3;&#x7EC6;&#x8282;">5.3 Callable&#x63A5;&#x53E3;&#x7EC6;&#x8282;</h3>
<h4 id="531-callable&#x63A5;&#x53E3;&#x4E2D;&#x7684;&#x601D;&#x60F3;">5.3.1 Callable&#x63A5;&#x53E3;&#x4E2D;&#x7684;&#x601D;&#x60F3;</h4>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;FutureTask&#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;get&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E4B;&#x540E;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x601D;&#x60F3;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124224631207.png" alt="image-20210124224631207"></p>
<p>&#x5047;&#x8BBE;&#x6BCF;&#x4E2A;&#x6B65;&#x9AA4;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x9700;&#x8981;5&#x79D2;&#x949F;&#xFF0C;&#x800C;&#x6B65;&#x9AA4;3&#x6267;&#x884C;&#x9700;&#x8981;20&#x79D2;</p>
<p>&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#x591A;&#x4E2A;&#x6B65;&#x9AA4;&#x5982;&#x679C;&#x662F;&#x540C;&#x6B65;&#x6267;&#x884C;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x662F;&#x4E32;&#x884C;&#x5316;&#x6267;&#x884C;&#xFF0C;&#x90A3;&#x4E48;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x5C31;&#x662F;35&#x79D2;</p>
<p>&#x5F53;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x5BF9;&#x4E8E;&#x6B65;&#x9AA4;3&#x53E6;&#x8D77;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x6B65;&#x9AA4;1,2,4&#x6267;&#x884C;&#x5B8C;&#x6210;&#x9700;&#x8981;15&#x79D2;&#xFF0C;&#x800C;&#x5728;&#x6B65;&#x9AA4;3&#x6267;&#x884C;&#x65F6;&#x5B9A;&#x4E49;&#x4E3A;FutrueTask&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;&#x800C;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x53EA;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x4E3B;&#x7EBF;&#x7A0B;5&#x79D2;&#x949F;&#xFF0C;&#x5E76;&#x63A5;&#x6536;&#x5230;&#x6B65;&#x9AA4;3&#x7684;&#x7ED3;&#x679C;&#xFF1B;&#x4ECE;&#x800C;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x4E3A;20&#x79D2;</p>
<p><code>&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5BF9;&#x4E8E;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x7ED9;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5E76;&#x5BF9;&#x8BE5;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#xFF0C;&#x5728;&#x6B64;&#x671F;&#x95F4;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x5176;&#x4ED6;&#x64CD;&#x4F5C;&#xFF0C;&#x5F53;&#x76D1;&#x542C;&#x5230;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x7684;&#x7EBF;&#x7A0B;&#x7ED3;&#x675F;&#xFF0C;&#x5C31;&#x63A5;&#x6536;&#x5BF9;&#x5E94;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x6548;&#x7387;</code></p>
<h4 id="532-futuretaskget&#x65B9;&#x6CD5;&#x4E00;&#x822C;&#x653E;&#x5728;&#x7ED3;&#x5C3E;">5.3.2 FutureTask.get()&#x65B9;&#x6CD5;&#x4E00;&#x822C;&#x653E;&#x5728;&#x7ED3;&#x5C3E;</h4>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x4E0B;&#x4E0D;&#x5C06;FutureTask.get()&#x65B9;&#x6CD5;&#x653E;&#x5728;&#x7ED3;&#x5C3E;&#x4F1A;&#x51FA;&#x73B0;&#x4EC0;&#x4E48;&#x60C5;&#x51B5;&#x5462;&#xFF1F;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallableDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>{
        FutureTask futureTask = <span class="hljs-keyword">new</span> FutureTask(<span class="hljs-keyword">new</span> MyThread());

        <span class="hljs-keyword">new</span> Thread(futureTask,<span class="hljs-string">&quot;A&quot;</span>).start();

        System.out.println(futureTask.get());
        System.out.println(<span class="hljs-string">&quot;&#x5176;&#x4ED6;&#x6B65;&#x9AA4;&#x5DF2;&#x5B8C;&#x6210;&quot;</span>);
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        System.out.println(<span class="hljs-string">&quot;&#x7EBF;&#x7A0B;&#x88AB;&#x8C03;&#x7528;&quot;</span>);
        TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124230121565.png" alt="image-20210124230121565"></p>
<blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x7ED3;&#x679C;&#x4E2D;&#x5148;&#x963B;&#x585E;&#x7740;&#x7B49;&#x5F85;&#x7EBF;&#x7A0B;&#x7ED3;&#x679C;&#x8BA1;&#x7B97;&#x4E4B;&#x540E;&#x518D;&#x6253;&#x5370;&quot;&#x5176;&#x4ED6;&#x6B65;&#x9AA4;&#x5DF2;&#x5B8C;&#x6210;&quot;</p>
</blockquote>
<p><code>&#x672C;&#x8D28;&#x4E0A;get()&#x65B9;&#x6CD5;&#x963B;&#x585E;&#xFF0C;&#x5982;&#x679C;&#x5C06;get()&#x653E;&#x5728;&#x524D;&#x9762;&#x5C31;&#x4F1A;&#x5F71;&#x54CD;main&#x7EBF;&#x7A0B;&#x7684;&#x6267;&#x884C;&#xFF0C;&#x6545;FutureTask&#x5BF9;&#x8C61;&#x7ED3;&#x679C;&#x7684;&#x8BA1;&#x7B97;&#x9700;&#x8981;&#x653E;&#x5728;&#x6700;&#x540E;&#x907F;&#x514D;&#x963B;&#x585E;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;</code></p>
<h4 id="533-futuretask&#x4EFB;&#x52A1;&#x591A;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x65F6;&#x53EA;&#x4F1A;&#x6267;&#x884C;&#x4E00;&#x6B21;">5.3.3 FutureTask&#x4EFB;&#x52A1;&#x591A;&#x7EBF;&#x7A0B;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x65F6;&#x53EA;&#x4F1A;&#x6267;&#x884C;&#x4E00;&#x6B21;</h4>
<p>&#x6D4B;&#x8BD5;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CallableDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>{
        FutureTask futureTask = <span class="hljs-keyword">new</span> FutureTask(<span class="hljs-keyword">new</span> MyThread());

        <span class="hljs-keyword">new</span> Thread(futureTask,<span class="hljs-string">&quot;A&quot;</span>).start();
        <span class="hljs-keyword">new</span> Thread(futureTask,<span class="hljs-string">&quot;B&quot;</span>).start();

        System.out.println(futureTask.get());
        System.out.println(<span class="hljs-string">&quot;&#x5176;&#x4ED6;&#x6B65;&#x9AA4;&#x5DF2;&#x5B8C;&#x6210;&quot;</span>);
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        System.out.println(<span class="hljs-string">&quot;&#x7EBF;&#x7A0B;&#x88AB;&#x8C03;&#x7528;&quot;</span>);
        TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210124230121565.png" alt="image-20210124230121565"></p>
<p>&#x539F;&#x56E0;&#xFF1A;</p>
<p><a href="https://blog.csdn.net/u010013573/article/details/87435850?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control" target="_blank">FutureTask&#x5F02;&#x6B65;&#x6267;&#x884C;&#x7ED3;&#x679C;</a></p>
<p><a href="https://blog.csdn.net/chenliguan/article/details/54345993" target="_blank">FutureTask&#x53EA;&#x4F1A;&#x6267;&#x884C;&#x4E00;&#x6B21;</a></p>
<p><a href="https://www.cnblogs.com/yaowen/p/11388001.html" target="_blank">FutureTask&#x6E90;&#x7801;</a></p>
<h2 id="6-juc&#x8F85;&#x52A9;&#x7C7B;">6 JUC&#x8F85;&#x52A9;&#x7C7B;</h2>
<h3 id="61-countdownlatch">6.1 CountDownLatch</h3>
<p>&#x5047;&#x8BBE;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E0B;&#x9762;&#x6709;6&#x4E2A;&#x5B50;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x7ED3;&#x675F;&#x5FC5;&#x987B;&#x8981;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x90FD;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x7ED3;&#x675F;</p>
<p>&#x6A21;&#x62DF;&#x573A;&#x666F;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountDownLatchDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) {
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5DF2;&#x7ED3;&#x675F;&quot;</span>);
            },String.valueOf(i)).start();
        }

        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5DF2;&#x7ED3;&#x675F;&quot;</span>);
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code class="lang-bash">0&#x5DF2;&#x7ED3;&#x675F;
4&#x5DF2;&#x7ED3;&#x675F;
2&#x5DF2;&#x7ED3;&#x675F;
main&#x5DF2;&#x7ED3;&#x675F;
3&#x5DF2;&#x7ED3;&#x675F;
1&#x5DF2;&#x7ED3;&#x675F;
5&#x5DF2;&#x7ED3;&#x675F;
</code></pre>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;main&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x4F1A;&#x5728;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6CA1;&#x6709;&#x7ED3;&#x675F;&#x4E4B;&#x524D;&#x7ED3;&#x675F;&#xFF0C;&#x90A3;&#x4E48;&#x5982;&#x4F55;&#x63A7;&#x5236;&#x8BE5;&#x987A;&#x5E8F;&#x5462;&#xFF1F;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountDownLatchDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        CountDownLatch latch = <span class="hljs-keyword">new</span> CountDownLatch(<span class="hljs-number">6</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) {
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5DF2;&#x7ED3;&#x675F;&quot;</span>);
                latch.countDown();
            },String.valueOf(i)).start();
        }
        latch.await();
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5DF2;&#x7ED3;&#x675F;&quot;</span>);
    }
}
</code></pre>
<blockquote>
<p>CountDownLatch&#x5C31;&#x662F;&#x7528;&#x4E8E;&#x63A7;&#x5236;&#x67D0;&#x4E2A;&#x7EBF;&#x7A0B;&#x5728;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x6267;&#x884C;</p>
</blockquote>
<h4 id="611-&#x6784;&#x9020;&#x5668;">6.1.1 &#x6784;&#x9020;&#x5668;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Constructs a {<span class="hljs-doctag">@code</span> CountDownLatch} initialized with the given count.
 *
 * <span class="hljs-doctag">@param</span> count the number of times {<span class="hljs-doctag">@link</span> #countDown} must be invoked
 *        before threads can pass through {<span class="hljs-doctag">@link</span> #await}
 * <span class="hljs-doctag">@throws</span> IllegalArgumentException if {<span class="hljs-doctag">@code</span> count} is negative
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CountDownLatch</span><span class="hljs-params">(<span class="hljs-keyword">int</span> count)</span> </span>{
    <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;count &lt; 0&quot;</span>);
    <span class="hljs-keyword">this</span>.sync = <span class="hljs-keyword">new</span> Sync(count);
}
</code></pre>
<p>&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;count&#x4ECE;&#x6CE8;&#x91CA;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5C31;&#x662F;<code>&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x6B21;&#x6570;</code></p>
<h4 id="612-countdown&#x65B9;&#x6CD5;">6.1.2 countDown&#x65B9;&#x6CD5;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Decrements the count of the latch, releasing all waiting threads if
 * the count reaches zero.
 *
 * &lt;p&gt;If the current count is greater than zero then it is decremented.
 * If the new count is zero then all waiting threads are re-enabled for
 * thread scheduling purposes.
 *
 * &lt;p&gt;If the current count equals zero then nothing happens.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">countDown</span><span class="hljs-params">()</span> </span>{
    sync.releaseShared(<span class="hljs-number">1</span>);
}
</code></pre>
<p>&#x4ECE;&#x6CE8;&#x91CA;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x5C31;&#x662F;&#x6BCF;&#x6B21;&#x8C03;&#x7528;&#x65F6;&#x5C31;&#x4F1A;&#x4F7F;&#x8BA1;&#x6570;&#x51CF;&#x5C11;1&#xFF0C;&#x5F53;&#x8BA1;&#x6570;&#x503C;&#x4E3A;0&#x65F6;&#x5C31;&#x4F1A;&#x5524;&#x9192;&#x88AB;&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;</p>
<h4 id="613-&#x7406;&#x89E3;">6.1.3 &#x7406;&#x89E3;</h4>
<p>&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x8C03;&#x7528;<code>latch.await()</code>&#x65B9;&#x6CD5;&#x65F6;&#x5728;&#x8BA1;&#x6570;&#x4E3A;0&#x4E4B;&#x524D;main&#x7EBF;&#x7A0B;&#x4F1A;&#x4E00;&#x76F4;&#x963B;&#x585E;</p>
<p>&#x800C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E4B;&#x540E;&#x8C03;&#x7528;<code>latch.countDown()</code>&#x65B9;&#x6CD5;&#x65F6;&#x5C31;&#x4F1A;&#x5C06;&#x8BA1;&#x6570;&#x51CF;&#x5C11;1</p>
<h3 id="62-cyclicbarric">6.2 CyclicBarric</h3>
<p>&#x6211;&#x4EEC;&#x77E5;&#x9053;CountDownLatch&#x662F;&#x5012;&#x7740;&#x5F00;&#x59CB;&#x8BA1;&#x6570;&#xFF0C;&#x800C;CyclicBarric&#x5C31;&#x662F;&#x6B63;&#x7740;&#x5F00;&#x59CB;&#x8BA1;&#x6570;&#xFF0C;&#x5F53;&#x6570;&#x91CF;&#x5230;&#x8FBE;&#x6307;&#x5B9A;&#x7684;&#x503C;&#x4E4B;&#x540E;&#xFF0C;&#x8BE5;&#x8FDB;&#x7A0B;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x963B;&#x585E;</p>
<h4 id="621-&#x6784;&#x9020;&#x5668;">6.2.1 &#x6784;&#x9020;&#x5668;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Creates a new {<span class="hljs-doctag">@code</span> CyclicBarrier} that will trip when the
 * given number of parties (threads) are waiting upon it, and which
 * will execute the given barrier action when the barrier is tripped,
 * performed by the last thread entering the barrier.
 *
 * <span class="hljs-doctag">@param</span> parties the number of threads that must invoke {<span class="hljs-doctag">@link</span> #await}
 *        before the barrier is tripped
 * <span class="hljs-doctag">@param</span> barrierAction the command to execute when the barrier is
 *        tripped, or {<span class="hljs-doctag">@code</span> null} if there is no action
 * <span class="hljs-doctag">@throws</span> IllegalArgumentException if {<span class="hljs-doctag">@code</span> parties} is less than 1
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CyclicBarrier</span><span class="hljs-params">(<span class="hljs-keyword">int</span> parties, Runnable barrierAction)</span> </span>{
    <span class="hljs-keyword">if</span> (parties &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException();
    <span class="hljs-keyword">this</span>.parties = parties;
    <span class="hljs-keyword">this</span>.count = parties;
    <span class="hljs-keyword">this</span>.barrierCommand = barrierAction;
}
</code></pre>
<p>&#x4ECE;&#x6CE8;&#x91CA;&#x4E2D;&#x770B;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;<code>parties</code>&#x5C31;&#x662F;&#x6307;&#x5B9A;&#x9700;&#x8981;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x591A;&#x5C11;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x7ED3;&#x675F;&#xFF0C;&#x800C;<code>barrierAction</code>&#x53C2;&#x6570;&#x5C31;&#x662F;&#x4E0D;&#x518D;&#x963B;&#x585E;&#x65F6;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;</p>
<h4 id="622-await&#x65B9;&#x6CD5;">6.2.2 await&#x65B9;&#x6CD5;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Waits until all {<span class="hljs-doctag">@linkplain</span> #getParties parties} have invoked
 * {<span class="hljs-doctag">@code</span> await} on this barrier.
 */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">await</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, BrokenBarrierException </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> dowait(<span class="hljs-keyword">false</span>, <span class="hljs-number">0L</span>);
        } <span class="hljs-keyword">catch</span> (TimeoutException toe) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(toe); <span class="hljs-comment">// cannot happen</span>
        }
    }
</code></pre>
<p>await&#x65B9;&#x6CD5;&#x5C31;&#x662F;&#x5728;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x8FDB;&#x884C;&#x8C03;&#x7528;&#xFF0C;&#x6BCF;&#x8C03;&#x7528;&#x4E00;&#x6B21;CyclicBarrier&#x7684;&#x5C5E;&#x6027;<code>parties</code>&#x5C31;&#x4F1A;&#x51CF;&#x5C11;1&#xFF0C;&#x5F53;&#x6570;&#x503C;&#x4E3A;0&#x65F6;&#x5C31;&#x4F1A;&#x8C03;&#x7528;CyclicBarrier&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;</p>
<h4 id="623-&#x6D4B;&#x8BD5;">6.2.3 &#x6D4B;&#x8BD5;</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CyclicBarrierDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        CyclicBarrier barrier = <span class="hljs-keyword">new</span> CyclicBarrier(<span class="hljs-number">7</span>,()-&gt;{
            System.out.println(<span class="hljs-string">&quot;&#x53EC;&#x5524;&#x795E;&#x9F99;&quot;</span>);
        });

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">7</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> temp = i;
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
               System.out.println(<span class="hljs-string">&quot;&#x7B2C;&quot;</span> + temp + <span class="hljs-string">&quot;&#x9897;&#x9F99;&#x73E0;&quot;</span>);
               <span class="hljs-keyword">try</span> {
                   barrier.await();
               } <span class="hljs-keyword">catch</span> (InterruptedException | BrokenBarrierException e) {
                   e.printStackTrace();
               }
           },String.valueOf(i)).start();
        }
    }
}
</code></pre>
<blockquote>
<p>&#x9996;&#x5148;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;CyclicBarrier&#x6307;&#x5B9A;&#x4E86;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x591A;&#x5C11;&#x4E2A;&#x7EBF;&#x7A0B;&#x5148;&#x6267;&#x884C;&#xFF0C;&#x5B9A;&#x4E49;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x64CD;&#x4F5C;</p>
<p>&#x5728;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x901A;&#x8FC7;&#x8C03;&#x7528;CyclicBarrier&#x5BF9;&#x8C61;&#x7684;await&#x65B9;&#x6CD5;&#x51CF;&#x5C11;<code>parties</code>&#x5C5E;&#x6027;&#x7684;&#x6570;&#x91CF;</p>
</blockquote>
<h3 id="63-semaphore">6.3 Semaphore</h3>
<p>&#x4FE1;&#x53F7;&#x91CF;&#xFF0C;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#x548C;&#x8D44;&#x6E90;&#x7684;&#x4E92;&#x65A5;&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x5C31;&#x662F;<code>&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E92;&#x65A5;&#x4FE1;&#x53F7;&#x91CF;&#x548C;&#x540C;&#x6B65;&#x4FE1;&#x53F7;&#x91CF;</code></p>
<p>&#x5047;&#x8BBE;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x8D44;&#x6E90;&#x548C;&#x7EBF;&#x7A0B;&#x90FD;&#x6709;&#x591A;&#x4E2A;&#xFF0C;&#x4F46;&#x662F;&#x7EBF;&#x7A0B;&#x7684;&#x6570;&#x91CF;&#x5927;&#x4E8E;&#x8D44;&#x6E90;&#x7684;&#x6570;&#x91CF;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemaphoreDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        Semaphore semaphore = <span class="hljs-keyword">new</span> Semaphore(<span class="hljs-number">3</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++) {
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    semaphore.acquire();
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x83B7;&#x53D6;&#x4E86;&#x8D44;&#x6E90;&quot;</span>);
                <span class="hljs-keyword">try</span> {
                    TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                } <span class="hljs-keyword">finally</span> {
                    semaphore.release();
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x91CA;&#x653E;&#x4E86;&#x8D44;&#x6E90;&quot;</span>);
                }
            },String.valueOf(i)).start();
        }
    }
}
</code></pre>
<blockquote>
<p>&#x901A;&#x8FC7;Semaphore&#x6784;&#x9020;&#x5668;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#x4E3A;3&#x7684;&#x4FE1;&#x53F7;&#x91CF;</p>
<p>&#x7D27;&#x63A5;&#x7740;&#x521B;&#x5EFA;&#x4E86;6&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;<code>semaphore.acquire()</code>&#x83B7;&#x53D6;&#x8D44;&#x6E90;&#xFF0C;&#x660E;&#x663E;&#x5F53;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#x4E3A;0&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5C31;&#x4F1A;&#x963B;&#x585E;</p>
<p>&#x5047;&#x8BBE;&#x7EBF;&#x7A0B;&#x4F11;&#x7720;3&#x79D2;&#x5C31;&#x662F;&#x8FDB;&#x884C;&#x4E86;&#x64CD;&#x4F5C;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x8FC7;<code>semaphore.release()</code>&#x91CA;&#x653E;&#x4E86;&#x8D44;&#x6E90;&#xFF0C;&#x91CA;&#x653E;&#x4E4B;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x77E5;<code>&#x5176;&#x4ED6;&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;</code>&#x83B7;&#x53D6;&#x8BE5;&#x8D44;&#x6E90;</p>
</blockquote>
<h4 id="631-&#x6784;&#x9020;&#x5668;">6.3.1 &#x6784;&#x9020;&#x5668;</h4>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Semaphore</span><span class="hljs-params">(<span class="hljs-keyword">int</span> permits)</span> </span>{
    sync = <span class="hljs-keyword">new</span> NonfairSync(permits);
}
<span class="hljs-comment">/**
 * Creates a {<span class="hljs-doctag">@code</span> Semaphore} with the given number of
 * permits and the given fairness setting.
 * <span class="hljs-doctag">@param</span> fair {<span class="hljs-doctag">@code</span> true} if this semaphore will guarantee
 *        first-in first-out granting of permits under contention,
 *        else {<span class="hljs-doctag">@code</span> false}
*/</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Semaphore</span><span class="hljs-params">(<span class="hljs-keyword">int</span> permits, <span class="hljs-keyword">boolean</span> fair)</span> </span>{
     sync = fair ? <span class="hljs-keyword">new</span> FairSync(permits) : <span class="hljs-keyword">new</span> NonfairSync(permits);
 }
</code></pre>
<p>&#x6784;&#x9020;&#x5668;&#x4E2D;&#x5982;&#x679C;&#x4F20;&#x5165;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x4EE3;&#x8868;&#x8D44;&#x6E90;&#x6570;&#x91CF;&#xFF0C;&#x7B2C;&#x4E8C;&#x53C2;&#x6570;&#x4EE3;&#x8868;&#x5224;&#x65AD;&#x662F;&#x5426;&#x516C;&#x5E73;</p>
<h4 id="632-acquire&#x65B9;&#x6CD5;">6.3.2 acquire&#x65B9;&#x6CD5;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Acquires a permit from this semaphore, blocking until one is
 * available, or the thread is {<span class="hljs-doctag">@linkplain</span> Thread#interrupt interrupted}.
 *
 * &lt;p&gt;Acquires a permit, if one is available and returns immediately,
 * reducing the number of available permits by one.
*/</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">acquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
    sync.acquireSharedInterruptibly(<span class="hljs-number">1</span>);
}
</code></pre>
<p>&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684;Semaphore&#x5BF9;&#x8C61;&#x7684;acquire&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</p>
<h4 id="633-release&#x65B9;&#x6CD5;">6.3.3 release&#x65B9;&#x6CD5;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Releases a permit, returning it to the semaphore.
 *
 * &lt;p&gt;Releases a permit, increasing the number of available permits by
 * one.  If any threads are trying to acquire a permit, then one is
 * selected and given the permit that was just released.  That thread
 * is (re)enabled for thread scheduling purposes.
 *
 * &lt;p&gt;There is no requirement that a thread that releases a permit must
 * have acquired that permit by calling {<span class="hljs-doctag">@link</span> #acquire}.
 * Correct usage of a semaphore is established by programming convention
 * in the application.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">release</span><span class="hljs-params">()</span> </span>{
    sync.releaseShared(<span class="hljs-number">1</span>);
}
</code></pre>
<p>&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684;Semaphore&#x5BF9;&#x8C61;&#x7684;release&#x65B9;&#x6CD5;&#x91CA;&#x653E;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;</p>
<h3 id="64-readwritelock">6.4 ReadWriteLock</h3>
<p>&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x8BFB;&#x540C;&#x4E00;&#x4E2A;&#x8D44;&#x6E90;&#x7C7B;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#xFF0C;&#x4E3A;&#x4E86;&#x6EE1;&#x8DB3;&#x5E76;&#x53D1;&#x91CF;&#xFF0C;&#x8BFB;&#x53D6;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x8FDB;&#x884C;</p>
<p>&#x4F46;&#x662F;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x60F3;&#x8981;&#x5199;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#xFF0C;&#x5C31;&#x4E0D;&#x5E94;&#x8BE5;&#x518D;&#x6709;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x5BF9;&#x8BE5;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x8BFB;&#x6216;&#x5199;</p>
<blockquote>
<p>&#x603B;&#x7ED3;&#x4E0B;&#x6765;&#x5C31;&#x662F;</p>
<p>1&#x3001;&#x8BFB;-&#x8BFB;&#x5171;&#x4EAB;</p>
<p>2&#x3001;&#x5199;-&#x8BFB;&#x72EC;&#x5360;</p>
<p>3&#x3001;&#x5199;-&#x5199;&#x72EC;&#x5360;</p>
</blockquote>
<p>&#x5982;&#x679C;&#x5047;&#x8BBE;&#x8BFB;&#x5199;&#x90FD;&#x4E0D;&#x52A0;&#x9501;&#x7684;&#x6761;&#x4EF6;&#x4E0B;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x4EC0;&#x4E48;&#x73B0;&#x8C61;&#x5462;&#xFF1F;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReadWriteLockDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        MyCache cache = <span class="hljs-keyword">new</span> MyCache();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">final</span> String temp = String.valueOf(i);
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                cache.put(temp,temp);
            },temp).start();
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">final</span> String temp = String.valueOf(i);
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                cache.get(temp);
            },temp).start();
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCache</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(String key,Object value)</span> </span>{
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x51C6;&#x5907;&#x5199;&#x5165;&#x6570;&#x636E;&quot;</span> + key);
        map.put(key,value);
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5199;&#x5165;&#x6570;&#x636E;&#x5B8C;&#x6210;&quot;</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>{
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x51C6;&#x5907;&#x8BFB;&#x53D6;&#x6570;&#x636E;&quot;</span>);
        Object res = map.get(key);
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5B8C;&#x6210;&quot;</span> + res);
        <span class="hljs-keyword">return</span> res;
    }
}
</code></pre>
<p>&#x8FD9;&#x91CC;&#x8BFB;&#x548C;&#x5199;&#x90FD;&#x6CA1;&#x6709;&#x52A0;&#x9501;&#xFF0C;&#x540C;&#x65F6;&#x5206;&#x522B;&#x5F00;&#x4E86;5&#x4E2A;&#x7EBF;&#x7A0B;&#x7528;&#x4E8E;&#x8BFB;&#x548C;&#x5199;</p>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125114904914.png" alt="image-20210125114904914"></p>
<blockquote>
<p>&#x5F53;&#x7EBF;&#x7A0B;0&#x51C6;&#x5907;&#x5199;&#x5165;&#x6570;&#x636E;&#x65F6;&#xFF0C;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x76F4;&#x63A5;&#x62A2;&#x5360;&#x4E86;CPU&#x6267;&#x884C;&#x6743;&#xFF0C;&#x5F88;&#x660E;&#x663E;&#x8FD9;&#x548C;&#x4E8B;&#x52A1;&#x7684;ACID&#x8FDD;&#x80CC;(&#x539F;&#x5B50;&#x6027;)</p>
</blockquote>
<h4 id="641-&#x4F7F;&#x7528;readwritelock&#x63A7;&#x5236;&#x8BFB;&#x5199;">6.4.1 &#x4F7F;&#x7528;ReadWriteLock&#x63A7;&#x5236;&#x8BFB;&#x5199;</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReadWriteLockDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        MyCache cache = <span class="hljs-keyword">new</span> MyCache();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">final</span> String temp = String.valueOf(i);
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                cache.put(temp,temp);
            },temp).start();
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">final</span> String temp = String.valueOf(i);
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                cache.get(temp);
            },temp).start();
        }
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCache</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> HashMap&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    <span class="hljs-keyword">private</span> ReadWriteLock lock = <span class="hljs-keyword">new</span> ReentrantReadWriteLock();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(String key,Object value)</span> </span>{
        lock.writeLock().lock();
        <span class="hljs-keyword">try</span> {
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x51C6;&#x5907;&#x5199;&#x5165;&#x6570;&#x636E;&quot;</span> + key);
            map.put(key,value);
            <span class="hljs-keyword">try</span> {
                TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x5199;&#x5165;&#x6570;&#x636E;&#x5B8C;&#x6210;&quot;</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.writeLock().unlock();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>{
        lock.readLock().lock();
        <span class="hljs-keyword">try</span> {
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x51C6;&#x5907;&#x8BFB;&#x53D6;&#x6570;&#x636E;&quot;</span>);
            Object res = map.get(key);
            <span class="hljs-keyword">try</span> {
                TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x5B8C;&#x6210;&quot;</span> + res);
            <span class="hljs-keyword">return</span> res;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.readLock().unlock();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}
</code></pre>
<blockquote>
<p>&#x9996;&#x5148;ReadWriteLock&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x5177;&#x4F53;&#x64CD;&#x4F5C;&#x65F6;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5B9E;&#x73B0;&#x7C7B;ReentrantReadWriteLock</p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x8981;&#x5BF9;&#x5199;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x63A7;&#x5236;&#xFF0C;&#x90A3;&#x4E48;&#x4E3A;&#x4EC0;&#x4E48;&#x8BFB;&#x64CD;&#x4F5C;&#x8FD8;&#x8981;&#x52A0;&#x9501;&#x5462;&#xFF1F;</p>
<blockquote>
<p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5728;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x65F6;&#x963B;&#x6B62;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x591A;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x540C;&#x6B65;&#x8FDB;&#x884C;</p>
<p><code>&#x8BFB;&#x9501;&#x662F;&#x5171;&#x4EAB;&#x9501;&#xFF0C;&#x591A;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#x5171;&#x4EAB;&#xFF1B;&#x5199;&#x9501;&#x662F;&#x6392;&#x4ED6;&#x9501;&#xFF0C;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x64CD;&#x4F5C;&#x4E0D;&#x80FD;&#x5171;&#x4EAB;</code></p>
</blockquote>
<h4 id="642-writelock&#x548C;readlock">6.4.2 writeLock&#x548C;readLock</h4>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReentrantReadWriteLock</span> </span>{
    <span class="hljs-comment">/** Inner class providing readlock */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock.ReadLock readerLock;
    <span class="hljs-comment">/** Inner class providing writelock */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantReadWriteLock.WriteLock writerLock;
    <span class="hljs-keyword">public</span> ReentrantReadWriteLock.<span class="hljs-function">WriteLock <span class="hljs-title">writeLock</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> writerLock; }
    <span class="hljs-keyword">public</span> ReentrantReadWriteLock.<span class="hljs-function">ReadLock  <span class="hljs-title">readLock</span><span class="hljs-params">()</span>  </span>{ <span class="hljs-keyword">return</span> readerLock; }
</code></pre>
<blockquote>
<p>&#x7C7B;&#x4E2D;&#x7EF4;&#x62A4;&#x4E86;&#x4E24;&#x4E2A;&#x5C5E;&#x6027;&#x5206;&#x522B;&#x4E3A;ReadLock&#x5BF9;&#x8C61;&#x548C;WriteLock&#x5BF9;&#x8C61;&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x8BFB;&#x5199;&#x8FDB;&#x884C;&#x63A7;&#x5236;</p>
<p>&#x6545;&#x5F53;&#x8D44;&#x6E90;&#x7C7B;&#x6D89;&#x53CA;&#x5230;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x8BFB;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8BFB;&#x9501;&#xFF0C;&#x5199;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5199;&#x9501;</p>
<p>&#x800C;ReadLock&#x548C;WriteLock&#x90FD;&#x5B9E;&#x73B0;&#x4E86;Lock&#x63A5;&#x53E3;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;lock&#x65B9;&#x6CD5;&#x548C;unlock&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x63A7;&#x5236;</p>
</blockquote>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125120926736.png" alt="image-20210125120926736"></p>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125121010446.png" alt=""></p>
<blockquote>
<p>&#x6BCF;&#x6B21;&#x8FDB;&#x884C;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#x90FD;&#x4E0D;&#x4F1A;&#x6709;&#x5176;&#x4ED6;&#x7684;&#x7EBF;&#x7A0B;&#x5360;&#x7528;&#x8D44;&#x6E90;(&#x8D44;&#x6E90;&#x72EC;&#x5360;)</p>
<p>&#x5F53;&#x8FDB;&#x884C;&#x5B8C;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x8BFB;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x591A;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x8D44;&#x6E90;</p>
</blockquote>
<h2 id="7-blockingqueue&#x963B;&#x585E;&#x961F;&#x5217;">7 BlockingQueue&#x963B;&#x585E;&#x961F;&#x5217;</h2>
<p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#x7EBF;&#x7A0B;&#x4E0D;&#x963B;&#x585E;&#x80AF;&#x5B9A;&#x6BD4;&#x8F83;&#x597D;&#xFF0C;&#x4F46;&#x662F;&#x67D0;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x5F97;&#x4E0D;&#x963B;&#x585E;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x963B;&#x585E;</p>
<p>&#x4F8B;&#x5982;&#x5F53;&#x706B;&#x9505;&#x5E97;&#x4EBA;&#x7279;&#x522B;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x4EBA;&#x5C31;&#x5FC5;&#x987B;&#x8981;&#x6392;&#x961F;&#x7B49;&#x5F85;&#x53EB;&#x53F7;&#xFF0C;&#x90A3;&#x4E48;&#x961F;&#x4F0D;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x505A;&#x963B;&#x585E;&#x961F;&#x5217;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/5bd6cc3d0001a58310000407.jpg" alt="5bd6cc3d0001a58310000407"></p>
<blockquote>
<p>&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x5143;&#x7D20;&#x7684;&#x64CD;&#x4F5C;&#x5C06;&#x4F1A;&#x88AB;&#x963B;&#x585E;</p>
<p>&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x6EE1;&#x65F6;&#xFF0C;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x7684;&#x64CD;&#x4F5C;&#x5C06;&#x4F1A;&#x88AB;&#x963B;&#x585E;</p>
</blockquote>
<p><code>&#x7C7B;&#x4F3C;&#x4E8E;&#x751F;&#x4EA7;&#x8005;&#x6D88;&#x8D39;&#x8005;&#x6A21;&#x578B;</code></p>
<p>&#x7528;&#x5904;&#xFF1A;</p>
<blockquote>
<p>&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x9886;&#x57DF;&#xFF1A;</p>
<pre><code>    &#x6240;&#x8C13;&#x963B;&#x585E;&#xFF0C;&#x5728;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;`&#x6302;&#x8D77;`&#x7EBF;&#x7A0B;&#xFF1B;&#x4E00;&#x65E6;&#x6761;&#x4EF6;&#x6EE1;&#x8DB3;&#xFF0C;&#x88AB;&#x963B;&#x585E;&#x7684;&#x7EBF;&#x7A0B;&#x53C8;&#x88AB;&#x91CD;&#x65B0;&#x5524;&#x9192;(&#x6BD4;&#x5982;wait&#x548C;notify&#x65B9;&#x6CD5;)
</code></pre><p>&#x4E3A;&#x4EC0;&#x4E48;&#x9700;&#x8981;BlockingQueue&#xFF1A;</p>
<p>&#x200B;            &#x4E0D;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x9700;&#x8981;&#x963B;&#x585E;&#x7EBF;&#x7A0B;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x5524;&#x9192;&#x7EBF;&#x7A0B;&#xFF0C;BlockingQueue&#x4F1A;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;</p>
</blockquote>
<h3 id="71-&#x7EE7;&#x627F;&#x6811;">7.1 &#x7EE7;&#x627F;&#x6811;</h3>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125203021009.png" alt="image-20210125203021009"></p>
<blockquote>
<p>&#x5728;Collection&#x63A5;&#x53E3;&#x4E0B;Queue&#x63A5;&#x53E3;&#x548C;List&#x3001;Set&#x63A5;&#x53E3;&#x5E73;&#x7EA7;&#xFF0C;&#x800C;BlockingQueue&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x4E8E;Queue&#x63A5;&#x53E3;</p>
<p>&#x6838;&#x5FC3;&#x5B9E;&#x73B0;&#x7C7B;&#xFF1A;</p>
<p>&#x200B;    ArrayBlockingQueue&#xFF1A;&#x7531;&#x6570;&#x7EC4;&#x6784;&#x6210;&#x7684;<code>&#x6709;&#x754C;</code>&#x963B;&#x585E;&#x961F;&#x5217;</p>
<p>&#x200B;    LinkedBlockingQueue&#xFF1A;&#x7531;&#x94FE;&#x8868;&#x7EC4;&#x6210;&#x7684;<code>&#x6709;&#x754C;</code>(&#x4F46;&#x5927;&#x5C0F;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;integer.MAX_VALUE)&#x963B;&#x585E;&#x961F;&#x5217;</p>
<p>&#x200B;    SynchronousQueue&#xFF1A;&#x4E0D;&#x5B58;&#x50A8;&#x5143;&#x7D20;&#x7684;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x4E5F;&#x5373;&#x5355;&#x4E2A;&#x5143;&#x7D20;&#x7684;&#x961F;&#x5217;</p>
</blockquote>
<h3 id="72-api">7.2 API</h3>
<h4 id="721-&#x6784;&#x9020;&#x5668;">7.2.1 &#x6784;&#x9020;&#x5668;</h4>
<pre><code class="lang-java"><span class="hljs-comment">/**
 * Creates an {<span class="hljs-doctag">@code</span> ArrayBlockingQueue} with the given (fixed)
 * capacity and default access policy.
 *
 * <span class="hljs-doctag">@param</span> capacity the capacity of this queue
 * <span class="hljs-doctag">@throws</span> IllegalArgumentException if {<span class="hljs-doctag">@code</span> capacity &lt; 1}
 */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayBlockingQueue</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>{
    <span class="hljs-keyword">this</span>(capacity, <span class="hljs-keyword">false</span>);
}
</code></pre>
<p>&#x901A;&#x8FC7;&#x4F20;&#x5165;&#x4E00;&#x4E2A;int&#x53C2;&#x6570;capacity&#x6765;&#x6307;&#x5B9A;&#x963B;&#x585E;&#x961F;&#x5217;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4ECE;&#x800C;&#x8BF4;&#x660E;&#x4E86;ArrayBlockingQueue&#x662F;&#x4E00;&#x4E2A;<strong>&#x6709;&#x754C;&#x7684;&#x963B;&#x585E;&#x961F;&#x5217;</strong></p>
<h4 id="722-add">7.2.2 add()</h4>
<p>&#x5411;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x963B;&#x585E;&#x961F;&#x5217;&#x6EE1;&#x65F6;&#x4F1A;&#x629B;&#x51FA;IllegalStateException&#xFF0C;&#x63D0;&#x793A;<code>Queue full</code></p>
<p>&#x6F14;&#x793A;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BolcokingQueueDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">3</span>);

        System.out.println(queue.add(<span class="hljs-string">&quot;a&quot;</span>));
        System.out.println(queue.add(<span class="hljs-string">&quot;b&quot;</span>));
        System.out.println(queue.add(<span class="hljs-string">&quot;c&quot;</span>));

        System.out.println(queue.add(<span class="hljs-string">&quot;x&quot;</span>));
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code>true
true
true
Exception in thread &quot;main&quot; java.lang.IllegalStateException: Queue full
</code></pre><blockquote>
<p>&#x5F53;&#x6CA1;&#x6709;&#x8D85;&#x51FA;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x65F6;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;&#x5E03;&#x5C14;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x63D2;&#x5165;&#x662F;&#x5426;&#x6210;&#x529F;</p>
</blockquote>
<h4 id="723-remove">7.2.3 remove()</h4>
<p>&#x4ECE;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E2D;&#x79FB;&#x9664;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x963B;&#x585E;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x518D;&#x6B21;&#x79FB;&#x9664;&#x4F1A;&#x629B;&#x51FA;NoSuchElementException</p>
<p>&#x6F14;&#x793A;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BolcokingQueueDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">3</span>);

        System.out.println(queue.add(<span class="hljs-string">&quot;a&quot;</span>));
        System.out.println(queue.add(<span class="hljs-string">&quot;b&quot;</span>));
        System.out.println(queue.add(<span class="hljs-string">&quot;c&quot;</span>));

        System.out.println(queue.remove());
        System.out.println(queue.remove());
        System.out.println(queue.remove());
        System.out.println(queue.remove());
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code>a
b
c
Exception in thread &quot;main&quot; java.util.NoSuchElementException
</code></pre><blockquote>
<p>&#x4ECE;&#x51FA;&#x961F;&#x5217;&#x7684;&#x987A;&#x5E8F;&#x4E5F;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x961F;&#x5217;&#x7684;&#x5148;&#x8FDB;&#x5148;&#x51FA;</p>
</blockquote>
<h4 id="724-element">7.2.4 element()</h4>
<p>&#x4E0D;&#x4F1A;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x5143;&#x7D20;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x7684;&#x5934;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#xFF0C;&#x4F1A;&#x629B;&#x51FA;NoSuchElementException</p>
<p>&#x6F14;&#x793A;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BolcokingQueueDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">3</span>);

        System.out.println(queue.add(<span class="hljs-string">&quot;a&quot;</span>));
        System.out.println(queue.add(<span class="hljs-string">&quot;b&quot;</span>));
        System.out.println(queue.add(<span class="hljs-string">&quot;c&quot;</span>));

        System.out.println(queue.element());
        System.out.println(queue.remove());
        System.out.println(queue.remove());
        System.out.println(queue.remove());
        System.out.println(queue.element());
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<pre><code>a
a
b
c
Exception in thread &quot;main&quot; java.util.NoSuchElementException
</code></pre><h4 id="725-offer">7.2.5 offer()</h4>
<p>&#x5411;&#x961F;&#x5217;&#x4E2D;&#x63D2;&#x5165;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x6EE1;&#x65F6;&#x5E76;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x8FD4;&#x56DE;false</p>
<h4 id="726-poll">7.2.6 poll()</h4>
<p>&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#x4E5F;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x8FD4;&#x56DE;null</p>
<h4 id="727-peek">7.2.7 peek()</h4>
<p>&#x4E0D;&#x4F1A;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x5143;&#x7D20;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x68C0;&#x67E5;&#x961F;&#x5217;&#x7684;&#x5934;&#x5143;&#x7D20;&#xFF1B;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x800C;&#x53EA;&#x662F;&#x8FD4;&#x56DE;null</p>
<h4 id="728-put">7.2.8 put()</h4>
<p>&#x5411;&#x961F;&#x5217;&#x4E2D;&#x63D2;&#x5165;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x6EE1;&#x65F6;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;null&#xFF1B;&#x800C;&#x662F;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BolcokingQueueDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">3</span>);

        queue.put(<span class="hljs-string">&quot;a&quot;</span>);
        queue.put(<span class="hljs-string">&quot;a&quot;</span>);
        queue.put(<span class="hljs-string">&quot;a&quot;</span>);
        queue.put(<span class="hljs-string">&quot;a&quot;</span>);
    }
}
</code></pre>
<blockquote>
<p>&#x7A0B;&#x5E8F;&#x4E00;&#x76F4;&#x5728;&#x6267;&#x884C;&#xFF0C;&#x8BF4;&#x660E;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;</p>
</blockquote>
<h4 id="729-take">7.2.9 take()</h4>
<p>&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;null&#xFF1B;&#x800C;&#x662F;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;</p>
<h4 id="7210-offeretimeunit">7.2.10 offer(e,time,unit)</h4>
<p>&#x5411;&#x961F;&#x5217;&#x4E2D;&#x63D2;&#x5165;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x6EE1;&#x65F6;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;null&#xFF0C;&#x800C;&#x662F;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF1B;&#x7136;&#x800C;&#x8FD9;&#x79CD;&#x963B;&#x585E;&#x72B6;&#x6001;&#x5177;&#x6709;&#x65F6;&#x95F4;&#x9650;&#x5236;&#xFF0C;&#x5F53;&#x8D85;&#x65F6;&#x65F6;&#x7A0B;&#x5E8F;&#x5C31;&#x4F1A;&#x7ED3;&#x675F;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8FD4;&#x56DE;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BolcokingQueueDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>{
        BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">3</span>);

        queue.offer(<span class="hljs-string">&quot;a&quot;</span>);
        queue.offer(<span class="hljs-string">&quot;a&quot;</span>);
        queue.offer(<span class="hljs-string">&quot;a&quot;</span>);
        queue.offer(<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-number">3</span>,TimeUnit.SECONDS);
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125212852806.png" alt="image-20210125212852806"></p>
<h4 id="7211-polletimeunit">7.2.11 poll(e,time,unit)</h4>
<p>&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x5143;&#x7D20;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x65F6;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;null&#xFF0C;&#x800C;&#x662F;&#x5904;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF1B;&#x7136;&#x800C;&#x8FD9;&#x79CD;&#x963B;&#x585E;&#x72B6;&#x6001;&#x5177;&#x6709;&#x65F6;&#x95F4;&#x9650;&#x5236;&#xFF0C;&#x5F53;&#x8D85;&#x65F6;&#x65F6;&#x7A0B;&#x5E8F;&#x5C31;&#x4F1A;&#x7ED3;&#x675F;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x8FD4;&#x56DE;</p>
<h2 id="8-volatile">8 volatile</h2>
<p>volatile&#x662F;Java&#x865A;&#x62DF;&#x673A;&#x63D0;&#x4F9B;&#x7684;&#x8F7B;&#x91CF;&#x7EA7;&#x540C;&#x6B65;&#x673A;&#x5236;&#xFF0C;&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x4FDD;&#x8BC1;&#x53EF;&#x89C1;&#x6027;</li>
<li><code>&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;</code></li>
<li>&#x7981;&#x6B62;&#x6307;&#x4EE4;&#x91CD;&#x6392;</li>
</ul>
<h3 id="81-jmmjava&#x5185;&#x5B58;&#x6A21;&#x578B;">8.1 JMM(JAVA&#x5185;&#x5B58;&#x6A21;&#x578B;)</h3>
<h4 id="811-&#x53EF;&#x89C1;&#x6027;">8.1.1 &#x53EF;&#x89C1;&#x6027;</h4>
<p>JMM&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x79CD;&#x62BD;&#x8C61;&#x7684;&#x6982;&#x5FF5;&#x5E76;&#x4E0D;&#x771F;&#x5B9E;&#x5B58;&#x5728;&#xFF0C;&#x63CF;&#x8FF0;&#x7684;&#x662F;&#x4E00;&#x7EC4;&#x89C4;&#x5219;&#x6216;&#x89C4;&#x8303;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x7EC4;&#x89C4;&#x8303;&#x5B9A;&#x4E49;&#x4E86;&#x7A0B;&#x5E8F;&#x4E2D;&#x5404;&#x4E2A;&#x53D8;&#x91CF;(&#x5305;&#x62EC;&#x5B9E;&#x4F8B;&#x5B57;&#x6BB5;&#xFF0C;&#x9759;&#x6001;&#x5B57;&#x6BB5;&#x548C;&#x6784;&#x6210;&#x6570;&#x7EC4;&#x5BF9;&#x8C61;&#x7684;&#x5143;&#x7D20;)&#x7684;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;</p>
<p>JMM&#x5173;&#x4E8E;&#x540C;&#x6B65;&#x7684;&#x89C4;&#x5B9A;&#xFF1A;</p>
<ul>
<li>&#x7EBF;&#x7A0B;&#x89E3;&#x9501;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x628A;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x503C;&#x5237;&#x65B0;&#x56DE;&#x4E3B;&#x5185;&#x5B58;</li>
<li>&#x7EBF;&#x7A0B;&#x52A0;&#x9501;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x8BFB;&#x53D6;&#x4E3B;&#x5185;&#x5B58;&#x6700;&#x65B0;&#x503C;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;</li>
<li>&#x52A0;&#x9501;&#x89E3;&#x9501;&#x662F;&#x540C;&#x4E00;&#x628A;&#x9501;</li>
</ul>
<p>&#x7531;&#x4E8E;JVM&#x8FD0;&#x884C;&#x7A0B;&#x5E8F;&#x7684;&#x5B9E;&#x4F53;&#x662F;&#x7EBF;&#x7A0B;&#xFF0C;&#x800C;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x65F6;JVM&#x90FD;&#x4F1A;&#x4E3A;&#x5668;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;(&#x6808;&#x7A7A;&#x95F4;)&#xFF0C;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x662F;&#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x79C1;&#x6709;&#x6570;&#x636E;&#x533A;&#x57DF;&#xFF0C;&#x800C;Java&#x5185;&#x5B58;&#x6A21;&#x578B;&#x89C4;&#x5B9A;&#x6240;&#x6709;&#x53D8;&#x91CF;&#x90FD;&#x5B58;&#x50A8;&#x5728;<code>&#x4E3B;&#x5185;&#x5B58;</code>&#xFF0C;&#x4E3B;&#x5185;&#x5B58;&#x662F;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x57DF;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x7EBF;&#x7A0B;&#x90FD;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#xFF0C;<code>&#x4F46;&#x7EBF;&#x7A0B;&#x5BF9;&#x53D8;&#x91CF;&#x7684;&#x64CD;&#x4F5C;(&#x8BFB;&#x5199;)&#x5FC5;&#x987B;&#x5728;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x8FDB;&#x884C;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x5C06;&#x53D8;&#x91CF;&#x4ECE;&#x4E3B;&#x5185;&#x5B58;&#x62F7;&#x8D1D;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x5BF9;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x540E;&#x518D;&#x5C06;&#x53D8;&#x91CF;&#x5199;&#x56DE;&#x4E3B;&#x5185;&#x5B58;</code>&#xFF0C;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x5404;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x4E3B;&#x8981;&#x5B58;&#x50A8;&#x7740;&#x4E3B;&#x5185;&#x5B58;&#x7684;<code>&#x53D8;&#x91CF;&#x62F7;&#x8D1D;&#x526F;&#x672C;</code>&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x5BF9;&#x65B9;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#xFF0C;&#x7EBF;&#x7A0B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x4E3B;&#x5185;&#x5B58;&#x6765;&#x5B8C;&#x6210;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/1673435-20190822095001999-1852846254.png" alt="1673435-20190822095001999-1852846254"></p>
<p>&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;student&#x5BF9;&#x8C61;&#xFF0C;&#x76EE;&#x524D;&#x6709;&#x4E09;&#x4E2A;&#x7EBF;&#x7A0B;&#x64CD;&#x4F5C;&#x8BE5;&#x5BF9;&#x8C61;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210126143828104.png" alt="image-20210126143828104"></p>
<blockquote>
<p>&#x4E3B;&#x5185;&#x5B58;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x5C31;&#x662F;&#x521B;&#x5EFA;&#x7684;student&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x4E09;&#x4E2A;&#x7EBF;&#x7A0B;&#x5404;&#x81EA;&#x7684;&#x5DE5;&#x4F5C;&#x5185;&#x5B58;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x662F;student&#x5BF9;&#x8C61;&#x7684;&#x526F;&#x672C;&#xFF0C;&#x5F53;t1&#x5BF9;student&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;<code>&#x5B9E;&#x9645;&#x4E0A;&#x4FEE;&#x6539;&#x7684;&#x503C;t2&#x548C;t3&#x5E76;&#x4E0D;&#x77E5;&#x9053;</code>&#xFF0C;&#x53EA;&#x6709;&#x5F53;t1&#x5C06;&#x65B0;&#x7684;student&#x5BF9;&#x8C61;&#x5199;&#x56DE;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x4E3B;&#x5185;&#x5B58;&#x5C31;&#x4F1A;&#x901A;&#x77E5;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x53D8;&#x66F4;&#x4E3A;&#x6700;&#x65B0;&#x7684;student&#x5BF9;&#x8C61;</p>
<p>&#x4E3B;&#x5185;&#x5B58;&#x66F4;&#x65B0;&#x4E4B;&#x540E;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x7B2C;&#x4E00;&#x65F6;&#x95F4;&#x83B7;&#x53D6;&#x5230;&#x6700;&#x65B0;&#x7684;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x53EF;&#x89C1;&#x6027;&#xFF0C;&#x5BF9;&#x4E8E;&#x7EBF;&#x7A0B;&#x53EF;&#x89C1;</p>
</blockquote>
<h5 id="8111-&#x53EF;&#x89C1;&#x6027;&#x6D4B;&#x8BD5;">8.1.1.1 &#x53EF;&#x89C1;&#x6027;&#x6D4B;&#x8BD5;</h5>
<p>&#x52A0;&#x5165;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x4E2D;&#x6CA1;&#x6709;&#x6DFB;&#x52A0;volatile&#x5173;&#x952E;&#x5B57;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VolatileDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        MyData myData = <span class="hljs-keyword">new</span> MyData();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t come in&quot;</span>);
            <span class="hljs-keyword">try</span> {
                TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            myData.add60();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t change value:&quot;</span> + myData.num);
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        <span class="hljs-keyword">while</span> (myData.num == <span class="hljs-number">0</span>) {

        }

        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;mission over&quot;</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyData</span> </span>{
    <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add60</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.num = <span class="hljs-number">60</span>;
    }
}
</code></pre>
<blockquote>
<p>&#x9996;&#x5148;MyData&#x5B9A;&#x4E49;&#x4E86;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x548C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x64CD;&#x4F5C;</p>
<p>main&#x65B9;&#x6CD5;&#x4E2D;&#x65B0;&#x8D77;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5BF9;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;main&#x7EBF;&#x7A0B;&#x76D1;&#x63A7;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x53D8;&#x5316;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53D8;&#x5316;&#x5C31;&#x4E00;&#x76F4;&#x5728;&#x6B7B;&#x5FAA;&#x73AF;&#x4E2D;</p>
</blockquote>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210126150245866.png" alt="image-20210126150245866"></p>
<blockquote>
<p>&#x4ECE;&#x7ED3;&#x679C;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;main&#x7EBF;&#x7A0B;&#x4E00;&#x76F4;&#x5728;&#x5FAA;&#x73AF;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x7684;&#x4FEE;&#x6539;&#x5E76;&#x6CA1;&#x6709;&#x5BF9;main&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x901A;&#x77E5;</p>
</blockquote>
<p>&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x6DFB;&#x52A0;volatile&#x5173;&#x952E;&#x5B57;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VolatileDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        MyData myData = <span class="hljs-keyword">new</span> MyData();

        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t come in&quot;</span>);
            <span class="hljs-keyword">try</span> {
                TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            myData.add60();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t change value:&quot;</span> + myData.num);
        },<span class="hljs-string">&quot;A&quot;</span>).start();

        <span class="hljs-keyword">while</span> (myData.num == <span class="hljs-number">0</span>) {

        }

        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;mission over&quot;</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyData</span> </span>{
    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add60</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.num = <span class="hljs-number">60</span>;
    }
}
</code></pre>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210126150620834.png" alt="image-20210126150620834"></p>
<h4 id="812-volatile&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;">8.1.2 volatile&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;</h4>
<h5 id="8121-&#x6D4B;&#x8BD5;volatile&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;">8.1.2.1 &#x6D4B;&#x8BD5;volatile&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;</h5>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VolatileDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        MyData myData = <span class="hljs-keyword">new</span> MyData();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
            <span class="hljs-keyword">new</span> Thread(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                    myData.addPlus();
                }
            },String.valueOf(i)).start();
        }

        <span class="hljs-keyword">while</span> (Thread.activeCount() &gt; <span class="hljs-number">2</span>) {
            Thread.yield();
        }

        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t finally value : &quot;</span> + myData.num);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyData</span> </span>{
    <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add60</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.num = <span class="hljs-number">60</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addPlus</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>.num++;
    }
}
</code></pre>
<blockquote>
<p>Thread.activeCount()&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x8BA1;&#x7B97;&#x5F53;&#x524D;&#x7684;&#x6D3B;&#x8DC3;&#x7EBF;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x77E5;&#x73B0;&#x5728;&#x6709;main&#x7EBF;&#x7A0B;&#x548C;GC&#x7EBF;&#x7A0B;</p>
<p>Thread.yield()&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x4F7F;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x793C;&#x8BA9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#xFF0C;&#x8BA9;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x5148;&#x6267;&#x884C;</p>
</blockquote>
<p>&#x7ED3;&#x679C;&#xFF1A;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210126152725585.png" alt="image-20210126152725585"></p>
<blockquote>
<p>&#x5982;&#x679C;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x90A3;&#x4E48;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x65F6;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x90FD;&#x4E0D;&#x80FD;&#x5E72;&#x6D89;&#xFF0C;&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x4E00;&#x5B9A;&#x662F;20000&#xFF0C;&#x53EF;&#x662F;&#x7ED3;&#x679C;&#x59CB;&#x7EC8;&#x90FD;&#x4E0D;&#x662F;20000&#x8868;&#x793A;&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;</p>
</blockquote>
<h4 id="8122-&#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;&#x539F;&#x7406;">8.1.2.2 &#x4E0D;&#x4FDD;&#x8BC1;&#x539F;&#x5B50;&#x6027;&#x539F;&#x7406;</h4>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x6BCF;&#x6B21;&#x8FD0;&#x884C;&#x7684;&#x7ED3;&#x679C;&#x90FD;&#x4E0D;&#x662F;20000&#x5462;&#xFF1F;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210126153504113.png" alt="image-20210126153504113"></p>
<blockquote>
<p>&#x5047;&#x8BBE;&#x5171;&#x4EAB;&#x53D8;&#x91CF;&#x521D;&#x59CB;&#x4E3A;0&#xFF0C;3&#x4E2A;&#x7EBF;&#x7A0B;&#x5206;&#x522B;&#x62FF;&#x5230;&#x4E86;&#x53D8;&#x91CF;&#x526F;&#x672C;&#xFF0C;&#x5047;&#x8BBE;3&#x4E2A;&#x7EBF;&#x7A0B;&#x8FD9;&#x65F6;&#x540C;&#x65F6;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#x53D8;&#x4E3A;1&#xFF1B;&#x6B64;&#x65F6;&#x4E09;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E92;&#x76F8;&#x4E4B;&#x95F4;&#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x5F53;t1&#x7EBF;&#x7A0B;&#x51C6;&#x5907;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x526F;&#x672C;&#x5199;&#x56DE;&#x4E3B;&#x5185;&#x5B58;&#x65F6;&#x7A81;&#x7136;&#x88AB;&#x6302;&#x8D77;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;t2&#x7EBF;&#x7A0B;&#x5C06;&#x81EA;&#x5DF1;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#x5199;&#x56DE;&#x5230;&#x4E3B;&#x5185;&#x5B58;&#xFF0C;&#x4E3B;&#x5185;&#x5B58;&#x901A;&#x77E5;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x81EA;&#x5DF1;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#xFF0C;&#x800C;&#x8FD9;&#x65F6;t1&#x7EBF;&#x7A0B;&#x7684;&#x53D8;&#x91CF;&#x526F;&#x672C;&#x5DF2;&#x7ECF;&#x53D8;&#x4E3A;1&#x4E86;</p>
<p>&#x4ECE;&#x800C;&#x9020;&#x6210;&#x8BA1;&#x7B97;&#x6570;&#x636E;&#x7684;&#x4E22;&#x5931;</p>
</blockquote>
<h2 id="9-threadpool&#x7EBF;&#x7A0B;&#x6C60;">9 ThreadPool&#x7EBF;&#x7A0B;&#x6C60;</h2>
<p>&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x5DE5;&#x4F5C;&#x5C31;&#x662F;&#x63A7;&#x5236;&#x8FD0;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#xFF0C;<strong>&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x5C06;&#x4EFB;&#x52A1;&#x653E;&#x5165;&#x961F;&#x5217;</strong>&#xFF0C;&#x7136;&#x540E;&#x5728;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x540E;&#x542F;&#x52A8;&#x8FD9;&#x4E9B;&#x4EFB;&#x52A1;&#xFF0C;<code>&#x5982;&#x679C;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x8D85;&#x8FC7;&#x4E86;&#x6700;&#x5927;&#x6570;&#x91CF;&#xFF0C;&#x8D85;&#x51FA;&#x6570;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#x6392;&#x961F;&#x7B49;&#x5019;</code>&#xFF0C;&#x7B49;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#xFF0C;&#x518D;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x4EFB;&#x52A1;&#x6765;&#x6267;&#x884C;</p>
<p>&#x7279;&#x70B9;&#xFF1A;</p>
<ul>
<li>&#x7EBF;&#x7A0B;&#x590D;&#x7528;&#xFF1B;&#x91CD;&#x590D;&#x5229;&#x7528;&#x5DF2;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#x964D;&#x4F4E;&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x9020;&#x6210;&#x7684;&#x6D88;&#x8017;</li>
<li>&#x63A7;&#x5236;&#x6700;&#x5927;&#x5E76;&#x53D1;&#x6570;&#x91CF;</li>
<li>&#x63D0;&#x9AD8;&#x54CD;&#x5E94;&#x901F;&#x5EA6;&#xFF1B;&#x5F53;&#x4EFB;&#x52A1;&#x8FBE;&#x5230;&#x65F6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x5C31;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x6267;&#x884C;</li>
<li>&#x63D0;&#x9AD8;&#x7EBF;&#x7A0B;&#x53EF;&#x7BA1;&#x7406;&#x6027;&#xFF1B;&#x7EBF;&#x7A0B;&#x662F;&#x7A00;&#x7F3A;&#x8D44;&#x6E90;&#xFF0C;&#x5982;&#x679C;&#x65E0;&#x9650;&#x5236;&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x4E0D;&#x4EC5;&#x4F1A;&#x6D88;&#x8017;&#x8D44;&#x6E90;&#xFF0C;&#x8FD8;&#x4F1A;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x7684;&#x7A33;&#x5B9A;&#x6027;&#xFF1B;&#x7EBF;&#x7A0B;&#x6C60;&#x53EF;&#x4EE5;&#x5BF9;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7EDF;&#x4E00;&#x7684;&#x5206;&#x914D;&#x3001;&#x8C03;&#x4F18;&#x548C;&#x76D1;&#x63A7;</li>
</ul>
<h3 id="91-&#x7EE7;&#x627F;&#x6811;">9.1 &#x7EE7;&#x627F;&#x6811;</h3>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125220909109.png" alt="image-20210125220909109"></p>
<h4 id="911-executor">9.1.1 Executor</h4>
<pre><code>An object that executes submitted Runnable tasks. This interface provides a way of decoupling task submission from the mechanics of how each task will be run, including details of thread use, scheduling, etc. An Executor is normally used instead of explicitly creating threads. For example, rather than invoking new Thread(new(RunnableTask())).start() for each of a set of tasks, you might use:
 Executor executor = anExecutor;
 executor.execute(new RunnableTask1());
 executor.execute(new RunnableTask2());
 ...
</code></pre><p>&#x4ECE;&#x5B98;&#x7F51;&#x7684;&#x89E3;&#x91CA;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;Executor&#x662F;&#x7528;&#x6765;&#x6267;&#x884C;&#x63D0;&#x4EA4;&#x7684;Runnable&#x4EFB;&#x52A1;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x9876;&#x7EA7;&#x63A5;&#x53E3;</p>
<h4 id="912-executorservice">9.1.2 ExecutorService</h4>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125221441366.png" alt="image-20210125221441366"></p>
<p>&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x63A5;&#x53E3;(&#x76F8;&#x5BF9;&#x4E8E;Executor&#x63A5;&#x53E3;&#x63D0;&#x4F9B;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x65B9;&#x6CD5;)</p>
<h4 id="913-threadpoolexecutor">9.1.3 ThreadPoolExecutor</h4>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125221705249.png" alt="image-20210125221705249"></p>
<p>&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;&#x4F7F;&#x7528;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;</p>
<h4 id="914-executors">9.1.4 Executors</h4>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125221808298.png" alt="image-20210125221808298"></p>
<p>Executor&#x7684;&#x5DE5;&#x5177;&#x7C7B;(&#x5DE5;&#x5382;&#x7C7B;)&#xFF0C;&#x7528;&#x6765;&#x751F;&#x6210;ThreadPoolExecutor&#x5BF9;&#x8C61;</p>
<h3 id="92-&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;">9.2 &#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;</h3>
<h4 id="921-executorsnewfixedthreadpool">9.2.1 Executors.newFixedThreadPool</h4>
<p>&#x521B;&#x5EFA;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x6C60;&#x4E2D;&#x7684;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x4E0D;&#x4F1A;&#x53D1;&#x751F;&#x6539;&#x53D8;&#xFF1B;<code>&#x9002;&#x7528;&#x4E8E;&#x6267;&#x884C;&#x957F;&#x671F;&#x4EFB;&#x52A1;</code></p>
<p>&#x6D4B;&#x8BD5;&#xFF1A;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExectorDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        ExecutorService pool = Executors.newFixedThreadPool(<span class="hljs-number">5</span>);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                pool.execute(() -&gt; {
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t &#x529E;&#x7406;&#x4E1A;&#x52A1;&quot;</span>);
                });
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            pool.shutdown();
        }
    }
}
</code></pre>
<blockquote>
<p>&#x7EBF;&#x7A0B;&#x6C60;&#x8C03;&#x7528;execute&#x65B9;&#x6CD5;&#xFF0C;&#x91CC;&#x9762;&#x4F20;&#x5165;Runnable&#x63A5;&#x53E3;&#x5B9E;&#x4F8B;&#x4F5C;&#x4E3A;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x53D6;&#x51FA;&#x7EBF;&#x7A0B;&#x6765;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x4EFB;&#x52A1;</p>
<p>&#x7EBF;&#x7A0B;&#x6C60;&#x9002;&#x7528;&#x5B8C;&#x6BD5;&#x9700;&#x8981;&#x8C03;&#x7528;shutdown&#x65B9;&#x6CD5;&#x5173;&#x95ED;&#x7EBF;&#x7A0B;&#x6C60;&#x8D44;&#x6E90;</p>
<p>Executors.newFixedThreadPool&#x4F20;&#x5165;int&#x53C2;&#x6570;&#x6765;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;</p>
</blockquote>
<h4 id="922-executorsnewsinglethreadexecutor">9.2.2 Executors.newSingleThreadExecutor()</h4>
<p>&#x521B;&#x5EFA;&#x5355;&#x4F8B;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExectorDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        ExecutorService pool = Executors.newSingleThreadExecutor();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                pool.execute(() -&gt; {
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t &#x529E;&#x7406;&#x4E1A;&#x52A1;&quot;</span>);
                });
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            pool.shutdown();
        }
    }
}
</code></pre>
<h4 id="923-executorsnewsinglethreadexecutor">9.2.3 Executors.newSingleThreadExecutor()</h4>
<p>&#x521B;&#x5EFA;&#x53EF;&#x6269;&#x5BB9;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x5F53;&#x6709;&#x591A;&#x4E2A;&#x4EFB;&#x52A1;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x8FDB;&#x5165;&#x961F;&#x5217;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF1B;&#x5F53;&#x4EFB;&#x52A1;&#x6570;&#x91CF;&#x8F83;&#x5C11;&#x65F6;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x6EE1;&#x8DB3;&#xFF0C;&#x5C31;&#x4E0D;&#x8FDB;&#x884C;&#x6269;&#x5BB9;</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExectorDemo</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        ExecutorService pool = Executors.newCachedThreadPool();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                pool.execute(() -&gt; {
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;\t &#x529E;&#x7406;&#x4E1A;&#x52A1;&quot;</span>);
                });
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            pool.shutdown();
        }
    }
}
</code></pre>
<h3 id="93-threadpoolexecutor&#x5E95;&#x5C42;&#x539F;&#x7406;">9.3 ThreadPoolExecutor&#x5E95;&#x5C42;&#x539F;&#x7406;</h3>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E0B;&#x901A;&#x8FC7;&#x5DE5;&#x5177;&#x7C7B;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x521B;&#x5EFA;&#x7684;&#xFF1F;</p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125223446688.png" alt="image-20210125223446688"></p>
<blockquote>
<p>&#x5B9E;&#x9645;&#x4E0A;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x521B;&#x5EFA;ThreadPoolExecutor&#x5BF9;&#x8C61;&#x4E14;&#x5DF2;&#x7ECF;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x4E9B;&#x53C2;&#x6570;&#x6765;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;</p>
</blockquote>
<h4 id="931-7&#x5927;&#x53C2;&#x6570;">9.3.1 7&#x5927;&#x53C2;&#x6570;</h4>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/image-20210125224008896.png" alt="image-20210125224008896"></p>
<ul>
<li>corePoolSize&#xFF1A;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x5E38;&#x9A7B;&#x7EBF;&#x7A0B;&#x6838;&#x5FC3;&#x6570;</li>
<li>maximumPoolSize&#xFF1A;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x80FD;&#x591F;&#x5BB9;&#x7EB3;&#x540C;&#x65F6;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x5FC5;&#x987B;&#x5927;&#x4E8E;1&#xFF1B;<code>&#x5F53;&#x963B;&#x585E;&#x961F;&#x5217;&#x6EE1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x4F1A;&#x521B;&#x5EFA;&#x975E;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;</code></li>
<li>keepAliveTime&#xFF1A;&#x591A;&#x4F59;&#x7684;&#x7A7A;&#x95F2;&#x7EBF;&#x7A0B;&#x7684;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#xFF0C;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x8D85;&#x8FC7;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;&#x65F6;(&#x800C;&#x975E;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x53C8;&#x6CA1;&#x6709;&#x4F7F;&#x7528;)&#xFF0C;&#x5F53;&#x7A7A;&#x95F2;&#x65F6;&#x95F4;&#x8FBE;&#x5230;keepAlive&#x65F6;&#xFF0C;&#x591A;&#x4F59;&#x7EBF;&#x7A0B;&#x5C31;&#x4F1A;&#x88AB;&#x9500;&#x6BC1;&#x76F4;&#x5230;&#x53EA;&#x5269;&#x4E0B;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;&#x4E3A;&#x6B62;</li>
<li>unit&#xFF1A;keepAliveTime&#x7684;&#x5355;&#x4F4D;</li>
<li>workQueue&#xFF1A;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#xFF0C;&#x88AB;&#x63D0;&#x4EA4;&#x4F46;&#x662F;&#x672A;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x963B;&#x585E;&#x961F;&#x5217;</li>
<li>threadFactory&#xFF1A;&#x751F;&#x6210;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x5DE5;&#x5382;&#xFF0C;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#xFF1B;<code>&#x4E00;&#x822C;&#x4F7F;&#x7528;&#x9ED8;&#x8BA4;&#x5373;&#x53EF;</code></li>
<li>handler&#xFF1A;&#x62D2;&#x7EDD;&#x7B56;&#x7565;&#xFF0C;&#x5F53;&#x963B;&#x585E;&#x961F;&#x5217;&#x6EE1;&#x4E86;&#xFF0C;&#x4E14;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5DF2;&#x7ECF;&#x5927;&#x4E8E;&#x7B49;&#x4E8E;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;&#x65F6;&#x5982;&#x4F55;&#x62D2;&#x7EDD;&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x7684;runnable&#x7684;&#x7B56;&#x7565;</li>
</ul>
<h4 id="932-&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#x6D41;&#x7A0B;">9.3.2 &#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#x6D41;&#x7A0B;</h4>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/cec330143ed7455eb64a6ed1c40ab075.jpg" alt="cec330143ed7455eb64a6ed1c40ab075"></p>
<p><img src="https://learning-pool.oss-cn-chengdu.aliyuncs.com/netty/u=380500544,3378234251&amp;fm=26&amp;gp=0.png" alt="u=380500544,3378234251&amp;fm=26&amp;gp=0"></p>
<p>&#x4EE5;&#x94F6;&#x884C;&#x4F5C;&#x4E3A;&#x4F8B;&#x5B50;&#x8FDB;&#x884C;&#x89E3;&#x6790;&#xFF1A;</p>
<blockquote>
<p>1&#x3001;&#x94F6;&#x884C;&#x5F53;&#x5929;&#x7684;&#x5F53;&#x503C;&#x7A97;&#x53E3;&#x4E5F;&#x5C31;&#x662F;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6570;&#xFF0C;&#x5F53;&#x6709;&#x4EBA;&#x529E;&#x7406;&#x4E1A;&#x52A1;(&#x4E5F;&#x5C31;&#x662F;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;)&#x65F6;&#x5C31;&#x8FDB;&#x5165;&#x5F53;&#x503C;&#x7A97;&#x53E3;</p>
<p>2&#x3001;&#x5F53;&#x5F53;&#x503C;&#x7A97;&#x53E3;&#x6EE1;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x5F00;&#x59CB;&#x6392;&#x961F;&#x7B49;&#x5019;(&#x4E5F;&#x5C31;&#x662F;&#x963B;&#x585E;&#x961F;&#x5217;)</p>
<p>3&#x3001;&#x5F53;&#x961F;&#x5217;&#x4E5F;&#x6EE1;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6CA1;&#x529E;&#x6CD5;&#x5C31;&#x53EA;&#x80FD;&#x628A;&#x6CA1;&#x6709;&#x5F53;&#x503C;&#x7684;&#x7A97;&#x53E3;(&#x6700;&#x5927;&#x7EBF;&#x7A0B;&#x6570;)&#x4E5F;&#x5F00;&#x4E86;&#xFF0C;&#x518D;&#x628A;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EBA;&#x5728;&#x975E;&#x6838;&#x5FC3;&#x7A97;&#x53E3;&#x529E;&#x7406;&#xFF0C;&#x800C;&#x4E4B;&#x540E;&#x5230;&#x6765;&#x7684;&#x4EBA;&#x8FDB;&#x5165;&#x961F;&#x5217;</p>
<p>4&#x3001;&#x5F53;&#x961F;&#x5217;&#x518D;&#x6B21;&#x6EE1;&#x4E86;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x62D2;&#x7EDD;&#x7B56;&#x7565;</p>
<p>5&#x3001;&#x529E;&#x7406;&#x7684;&#x4EBA;&#x8D8A;&#x6765;&#x8D8A;&#x5C11;&#xFF0C;&#x5F53;&#x975E;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x7A7A;&#x95F2;&#x72B6;&#x6001;&#xFF0C;&#x4E14;&#x5DF2;&#x7ECF;&#x8D85;&#x8FC7;&#x4E86;&#x6700;&#x5927;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;&#xFF0C;&#x5C31;&#x5F00;&#x59CB;&#x6162;&#x6162;&#x7684;&#x5173;&#x95ED;&#x975E;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;</p>
</blockquote>
<h4 id="933-&#x4E0D;&#x80FD;&#x901A;&#x8FC7;executors&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;">9.3.3 &#x4E0D;&#x80FD;&#x901A;&#x8FC7;Executors&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6C60;</h4>
<p>&#x963F;&#x91CC;&#x5DF4;&#x5DF4;Java&#x5F00;&#x53D1;&#x624B;&#x518C;&#xFF1A;</p>
<pre><code>3. &#x3010;&#x5F3A;&#x5236;&#x3011;&#x7EBF;&#x7A0B;&#x8D44;&#x6E90;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x7EBF;&#x7A0B;&#x6C60;&#x63D0;&#x4F9B;&#xFF0C;&#x4E0D;&#x5141;&#x8BB8;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x81EA;&#x884C;&#x663E;&#x5F0F;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;
    &#x8BF4;&#x660E;&#xFF1A;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x597D;&#x5904;&#x662F;&#x51CF;&#x5C11;&#x5728;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x7EBF;&#x7A0B;&#x4E0A;&#x6240;&#x82B1;&#x7684;&#x65F6;&#x95F4;&#x4EE5;&#x53CA;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x7684;&#x5F00;&#x9500;&#xFF0C;&#x89E3;&#x51B3;&#x8D44;
    &#x6E90;&#x4E0D;&#x8DB3;&#x7684;&#x95EE;&#x9898;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x7CFB;&#x7EDF;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x540C;&#x7C7B;&#x7EBF;&#x7A0B;&#x800C;&#x5BFC;&#x81F4;&#x6D88;&#x8017;&#x5B8C;&#x5185;&#x5B58;&#x6216;&#x8005;
    &#x201C;&#x8FC7;&#x5EA6;&#x5207;&#x6362;&#x201D;&#x7684;&#x95EE;&#x9898;
4. &#x3010;&#x5F3A;&#x5236;&#x3011;&#x7EBF;&#x7A0B;&#x6C60;&#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;Executors&#x53BB;&#x521B;&#x5EFA;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;ThreadPoolExecutor&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x8BA9;&#x5199;&#x7684;&#x540C;&#x5B66;&#x66F4;&#x52A0;&#x660E;&#x786E;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x8FD0;&#x884C;&#x89C4;&#x5219;&#xFF0C;&#x89C4;&#x907F;&#x8D44;&#x6E90;&#x8017;&#x5C3D;&#x7684;&#x98CE;&#x9669;
    &#x8BF4;&#x660E;&#xFF1A; Executors &#x8FD4;&#x56DE;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x5BF9;&#x8C61;&#x7684;&#x5F0A;&#x7AEF;&#x5982;&#x4E0B;&#xFF1A;
    1&#xFF09; FixedThreadPool &#x548C; SingleThreadPool :
    &#x5141;&#x8BB8;&#x7684;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x957F;&#x5EA6;&#x4E3A; Integer.MAX_VALUE&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5806;&#x79EF;&#x5927;&#x91CF;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;OOM 
    2&#xFF09; CachedThreadPool&#x548C;ScheduledThreadPool :
    &#x5141;&#x8BB8;&#x7684;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x6570;&#x91CF;&#x4E3A; Integer.MAX_VALUE&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;OOM
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Introduction">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="JVM.html" class="navigation navigation-next " aria-label="Next page: JVM">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"JUC","level":"1.2","depth":1,"next":{"title":"JVM","level":"1.3","depth":1,"path":"JVM.md","ref":"JVM.md","articles":[]},"previous":{"title":"Introduction","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"JUC.md","mtime":"2021-01-26T12:16:00.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-01-29T02:08:49.101Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

